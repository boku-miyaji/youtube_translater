# YouTube Bot æ¤œå‡ºã‚’å›é¿ã™ã‚‹æ–¹æ³•

## å•é¡Œ

YouTube ã¯ bot ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ¤œå‡ºã—ã¦ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:
```
Sign in to confirm you're not a bot
```

## è§£æ±ºç­–

ãƒ–ãƒ©ã‚¦ã‚¶ã§ YouTube ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸçŠ¶æ…‹ã®ã‚¯ãƒƒã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€bot æ¤œå‡ºã‚’å›é¿ã§ãã¾ã™ã€‚

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### æ–¹æ³• 1: ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

1. **Chrome/Edge ã®å ´åˆ**
   - æ‹¡å¼µæ©Ÿèƒ½ "Get cookies.txt LOCALLY" ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   - https://chrome.google.com/webstore/detail/get-cookiestxt-locally/cclelndahbckbenkjhflpdbgdldlbecc

2. **YouTube ã«ãƒ­ã‚°ã‚¤ãƒ³**
   - ãƒ–ãƒ©ã‚¦ã‚¶ã§ https://youtube.com ã«ã‚¢ã‚¯ã‚»ã‚¹
   - Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³

3. **ã‚¯ãƒƒã‚­ãƒ¼ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**
   - YouTube ã®ãƒšãƒ¼ã‚¸ã§æ‹¡å¼µæ©Ÿèƒ½ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - "Export as JSON" ã‚’é¸æŠ
   - ã‚¯ãƒƒã‚­ãƒ¼ã® JSON ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼

4. **ç’°å¢ƒå¤‰æ•°ã«è¨­å®š**
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
   - ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ :
   ```bash
   YOUTUBE_COOKIES='[{"name":"...", "value":"..."}]'
   ```
   - ã‚³ãƒ”ãƒ¼ã—ãŸã‚¯ãƒƒã‚­ãƒ¼ JSON ã‚’ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã®ä¸­ã«è²¼ã‚Šä»˜ã‘

### æ–¹æ³• 2: ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨

1. **YouTube ã«ãƒ­ã‚°ã‚¤ãƒ³**
   - ãƒ–ãƒ©ã‚¦ã‚¶ã§ https://youtube.com ã«ã‚¢ã‚¯ã‚»ã‚¹
   - Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³

2. **é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã**
   - Chrome/Edge: F12 ã¾ãŸã¯å³ã‚¯ãƒªãƒƒã‚¯ â†’ æ¤œè¨¼
   - Firefox: F12 ã¾ãŸã¯å³ã‚¯ãƒªãƒƒã‚¯ â†’ è¦ç´ ã‚’èª¿æŸ»

3. **Console ã‚¿ãƒ–ã§ã‚¯ãƒƒã‚­ãƒ¼ã‚’å–å¾—**
   - ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ:
   ```javascript
   copy(JSON.stringify(document.cookie.split('; ').map(c => {
     const [name, ...value] = c.split('=');
     return { name, value: value.join('='), domain: '.youtube.com' };
   })))
   ```
   - ã‚¯ãƒƒã‚­ãƒ¼ãŒã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã™

4. **ç’°å¢ƒå¤‰æ•°ã«è¨­å®š**
   - `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ :
   ```bash
   YOUTUBE_COOKIES='[ã‚³ãƒ”ãƒ¼ã—ãŸJSON]'
   ```

### æ–¹æ³• 3: User-Agent ã®ã¿ä½¿ç”¨ï¼ˆã‚¯ãƒƒã‚­ãƒ¼ãªã—ï¼‰

ã‚¯ãƒƒã‚­ãƒ¼ã‚’è¨­å®šã—ãªãã¦ã‚‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯è‡ªå‹•çš„ã« Chrome ãƒ–ãƒ©ã‚¦ã‚¶ã® User-Agent ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
å¤šãã®å ´åˆã€ã“ã‚Œã ã‘ã§ bot æ¤œå‡ºã‚’å›é¿ã§ãã¾ã™ã€‚

**User-Agent:**
```
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36
```

**è¿½åŠ ãƒ˜ãƒƒãƒ€ãƒ¼:**
- `Accept-Language: ja-JP,ja;q=0.9,en-US;q=0.8,en;q=0.7`
- `Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8`
- `Connection: keep-alive`

## .env ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹

```bash
# OpenAI API ã‚­ãƒ¼ï¼ˆå¿…é ˆï¼‰
OPENAI_API_KEY=sk-...

# YouTube ã‚¯ãƒƒã‚­ãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ - bot æ¤œå‡ºã‚’å›é¿ã™ã‚‹ãŸã‚ï¼‰
YOUTUBE_COOKIES='[{"name":"VISITOR_INFO1_LIVE","value":"...","domain":".youtube.com"},{"name":"CONSENT","value":"...","domain":".youtube.com"}]'
```

## ç¢ºèªæ–¹æ³•

1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•
2. ãƒ­ã‚°ã‚’ç¢ºèª:
   ```
   ğŸ¥ ytdl-core configuration: {
     hasCookies: true,
     userAgent: 'Chrome/120.0.0.0'
   }
   ```
3. `hasCookies: true` ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°è¨­å®šæˆåŠŸ

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¯ãƒƒã‚­ãƒ¼ã‚’è¨­å®šã—ãŸã®ã« bot æ¤œå‡ºã•ã‚Œã‚‹

1. **ã‚¯ãƒƒã‚­ãƒ¼ãŒæœŸé™åˆ‡ã‚Œã®å¯èƒ½æ€§**
   - ãƒ–ãƒ©ã‚¦ã‚¶ã§ YouTube ã«å†ãƒ­ã‚°ã‚¤ãƒ³
   - ã‚¯ãƒƒã‚­ãƒ¼ã‚’å†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
   - `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°

2. **ã‚¯ãƒƒã‚­ãƒ¼ã®å½¢å¼ãŒé–“é•ã£ã¦ã„ã‚‹**
   - JSON é…åˆ—å½¢å¼ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª: `[{...}]`
   - ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚€ã“ã¨: `'[...]'`
   - ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ä¸è¦

3. **IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹**
   - çŸ­æ™‚é–“ã«å¤§é‡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã£ãŸå ´åˆ
   - ã—ã°ã‚‰ãï¼ˆ30åˆ†ã€œ1æ™‚é–“ï¼‰å¾…ã¤
   - VPN ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ç„¡åŠ¹ã«ã™ã‚‹

### User-Agent ã ã‘ã§å‹•ä½œã™ã‚‹å ´åˆ

ã‚¯ãƒƒã‚­ãƒ¼ãŒãªãã¦ã‚‚å‹•ä½œã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™:
- æ–°ã—ã„å‹•ç”»
- äººæ°—ã®å‹•ç”»
- å­—å¹•ä»˜ãã®å‹•ç”»

ã‚¯ãƒƒã‚­ãƒ¼ãŒã‚ã‚‹ã¨æˆåŠŸç‡ãŒä¸ŠãŒã‚Šã¾ã™:
- åˆ¶é™ä»˜ãå‹•ç”»
- å¤ã„å‹•ç”»
- å¹´é½¢åˆ¶é™ã®ã‚ã‚‹å‹•ç”»

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„äº‹é …

âš ï¸ **é‡è¦**: ã‚¯ãƒƒã‚­ãƒ¼ã«ã¯èªè¨¼æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™

- `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ Git ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ï¼ˆ`.gitignore` ã«è¿½åŠ æ¸ˆã¿ï¼‰
- ã‚¯ãƒƒã‚­ãƒ¼ã‚’å…¬é–‹ãƒªãƒã‚¸ãƒˆãƒªã« push ã—ãªã„
- å®šæœŸçš„ã«ã‚¯ãƒƒã‚­ãƒ¼ã‚’æ›´æ–°ã™ã‚‹
- æœ¬ç•ªç’°å¢ƒã§ã¯ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦å®‰å…¨ã«ç®¡ç†ã™ã‚‹

## å®Ÿè£…ã®è©³ç´°

### ã‚³ãƒ¼ãƒ‰å†…ã§ã®å‡¦ç†

**server.ts:**
```typescript
// ytdl-core ã®è¨­å®š
const getYtdlOptions = () => {
  const options: any = {
    requestOptions: {
      headers: {
        'User-Agent': 'Mozilla/5.0 ...',
        'Accept-Language': 'ja-JP,ja;q=0.9,...',
        // ...
      }
    }
  };

  // ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ã‚¯ãƒƒã‚­ãƒ¼ã‚’èª­ã¿è¾¼ã‚€
  if (process.env.YOUTUBE_COOKIES) {
    options.agent = ytdl.createAgent(JSON.parse(process.env.YOUTUBE_COOKIES));
  }

  return options;
};

// ã™ã¹ã¦ã® ytdl å‘¼ã³å‡ºã—ã§ä½¿ç”¨
const info = await ytdl.getInfo(url, getYtdlOptions());
```

### å¯¾å¿œã—ã¦ã„ã‚‹æ“ä½œ

ä»¥ä¸‹ã®æ“ä½œã§ bot æ¤œå‡ºå›é¿ãŒæœ‰åŠ¹:
- âœ… ã‚³ã‚¹ãƒˆäºˆæ¸¬ (`/api/estimate-cost-url`)
- âœ… ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾— (`getYouTubeMetadata`)
- âœ… å‹•ç”»æƒ…å ±å–å¾— (`/api/upload-youtube`)
- âœ… éŸ³å£°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ (`downloadYouTubeAudio`)

## å‚è€ƒãƒªãƒ³ã‚¯

- [@distube/ytdl-core ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/distubejs/ytdl-core)
- [YouTube ã® bot æ¤œå‡ºã«ã¤ã„ã¦](https://github.com/distubejs/ytdl-core#does-ytdl-core-work-with-live-videos)
- [ã‚¯ãƒƒã‚­ãƒ¼ã®å½¢å¼](https://github.com/distubejs/ytdl-core#cookie-support)
