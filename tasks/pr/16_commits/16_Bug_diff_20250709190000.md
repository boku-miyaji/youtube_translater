# Issue #16 - 包括的な動画分析と処理時間統計機能の実装差分

## 実装日時: 2025-07-09 19:00:00

## 実装内容
解析画面に推論動画数の分析や推論時間などの分析情報を追加し、コスト情報だけでなく包括的な分析データを表示できるようにしました。

## 主な変更点

### 1. **新しいhooksの追加** (`src/components/pages/AnalyzePage.tsx`)
- **useHistoryフック**: 履歴データの取得
- **useCostsフック**: コストデータの取得
- 既存のuseAppStoreと組み合わせて包括的なデータ分析を実現

### 2. **📊 動画分析統計セクション**
- **総処理動画数**: 全体の処理済み動画数を表示
- **今週の処理数**: 直近7日間の処理実績
- **処理方法別統計**: 
  - Whisper AI処理本数
  - YouTube字幕処理本数
- **履歴データ活用**: 既存の履歴データから統計を算出

### 3. **⏱️ 処理時間分析セクション**
- **平均処理時間**: 全動画の平均処理時間を計算
- **最短・最長時間**: 処理時間の範囲を表示
- **処理効率**: 分あたりの処理可能動画数を算出
- **時間フォーマット**: 秒・分の適切な表示形式

### 4. **🧠 推論統計セクション（拡張版）**
- **API呼び出し数**: 実際のAPI呼び出し回数
- **合計トークン数**: 入力・出力トークンの合計
- **入力/出力比**: トークンの詳細内訳
- **トークン/秒**: 処理速度指標
- **効率スコア**: 0-100の性能評価

### 5. **💸 コスト分析要約セクション**
- **総コスト**: 全動画処理の累計コスト
- **平均コスト**: 動画あたりの平均コスト
- **今日の合計**: 当日の処理コスト
- **コスト効率**: 処理効率とコストの関係

## 技術的な実装詳細

### データ取得と計算
```typescript
// 履歴データの取得
const { data: history } = useHistory()
const { data: costs } = useCosts()

// 処理時間統計の計算
const processingTimes = history.map(h => h.analysisTime?.duration).filter(Boolean)
const avgTime = processingTimes.reduce((a, b) => a + b, 0) / processingTimes.length

// 動画数統計の計算
const whisperVideos = history.filter(h => h.method === 'whisper').length
const recentVideos = history.filter(h => 
  new Date(h.timestamp) > new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)
).length
```

### リアルタイム計算
- 即座実行関数式（IIFE）を使用したリアルタイム統計計算
- 条件分岐による適切なデータ表示制御
- エラーハンドリングとフォールバック値の設定

### UI/UX改善
- 各セクションに適切なアイコンとタイトル
- 統一された表示スタイル
- 数値の適切なフォーマット
- レスポンシブデザイン対応

## 表示される分析情報

### 動画分析統計
- 総処理動画数: XX本
- 今週の処理: XX本
- Whisper AI処理: XX本
- YouTube字幕処理: XX本

### 処理時間分析
- 平均処理時間: XX分XX秒
- 最短時間: XX秒
- 最長時間: XX分XX秒
- 処理効率: X.X本/分

### 推論統計
- API呼び出し数: XX回
- 合計トークン: XXXX
- 入力/出力: XXX/XXX
- トークン/秒: XX.X
- 効率スコア: XX/100

### コスト分析
- 総コスト: $X.XXXX
- 平均コスト: $X.XXXX/本
- 今日の合計: $X.XXXX

## 影響範囲
- analyze画面の分析情報表示部分の大幅拡張
- 既存の分析コストと解析時間表示は保持
- 新しい統計情報の追加による情報量の向上

## 効果
- 単なるコスト情報だけでなく、包括的な分析データを提供
- 処理パフォーマンスの可視化
- 動画処理の効率性分析
- データドリブンな意思決定のサポート
- 使用状況の詳細な把握

## 今後の拡張可能性
- 日別・週別・月別のトレンド分析
- モデル別の詳細統計
- 処理速度の最適化提案
- カスタムフィルタリング機能