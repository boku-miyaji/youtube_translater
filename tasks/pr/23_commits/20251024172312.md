# Commit: Historical Data Tracking for Time Estimation

**Commit Hash**: 5531413
**Date**: 2025-10-24 17:23:12
**Branch**: feature/implement-23

## èƒŒæ™¯

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®è¦æœ›ï¼š
> æ¨è«–æ™‚é–“ã¯éå»ã®ã‚‚ã®ã‚’å‚è€ƒã«ã—ã¦æ¨å®šæ™‚é–“ã‚’å‡ºã—ã¦ã€‚æ–‡å­—èµ·ã“ã—ã¨è¦ç´„ä½œæˆã«åˆ†ã‘ã¦ã¡ã‚ƒã‚“ã¨è¨˜éŒ²ã—ã¦ã€‚å‹•ç”»ã¨æ–‡æ›¸ã®è§£æã§æ¨è«–ãƒ­ã‚¸ãƒƒã‚¯ãŒé•ã†ã®ã§åˆ†ã‘ã¦æ¨å®šæ™‚é–“ã‚’å‡ºã—ã¦ã€‚

**ç¿»è¨³:**
- éå»ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦å‡¦ç†æ™‚é–“ã‚’æ¨å®šã™ã‚‹
- æ–‡å­—èµ·ã“ã—ã¨è¦ç´„ä½œæˆã‚’åˆ†ã‘ã¦è¨˜éŒ²ã™ã‚‹
- å‹•ç”»ã¨æ–‡æ›¸ã§ç•°ãªã‚‹æ¨å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹

## å•é¡Œåˆ†æ

### å•é¡Œ1: PDFã®å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ãªã„

**ç¾çŠ¶:**
```typescript
// PDF endpoint (/api/analyze-pdf) ã«ã¯ analysisProgressDB ã®å‘¼ã³å‡ºã—ãŒãªã„
// â†’ å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒè“„ç©ã•ã‚Œãªã„
// â†’ æ¨å®šæ™‚é–“ãŒå¸¸ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
// â†’ çµŒé¨“ã‹ã‚‰å­¦ç¿’ã—ãªã„
```

**å½±éŸ¿:**
- PDFã‚’ä½•å›å‡¦ç†ã—ã¦ã‚‚æ¨å®šæ™‚é–“ãŒæ”¹å–„ã•ã‚Œãªã„
- ã€Œéå»ã®å®Ÿç¸¾ã‹ã‚‰ç®—å‡ºã€ãƒãƒƒã‚¸ãŒè¡¨ç¤ºã•ã‚Œãªã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å¸¸ã«ä¸æ­£ç¢ºãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨å®šã‚’è¦‹ã‚‹

### å•é¡Œ2: PDF contentTypeStats ã®è¨ˆç®—ãŒé–“é•ã£ã¦ã„ã‚‹

**ç¾çŠ¶:**
```typescript
// analysis-progress.ts ã® calculateContentTypeStats()
const transcriptionAverage = records.reduce((sum, r) =>
  sum + r.transcriptionDuration / (r.contentDuration / 60), 0) / records.length;
// â†‘ å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ã§ã€Œç§’/åˆ†ã€è¨ˆç®—
// PDF ã® contentDuration ã¯ãƒšãƒ¼ã‚¸æ•°ãªã®ã«ã€60ã§å‰²ã£ã¦ã„ã‚‹ â† é–“é•ã„ï¼
```

**å…·ä½“ä¾‹:**
```
10ãƒšãƒ¼ã‚¸ã®PDFã€æŠ½å‡ºæ™‚é–“15ç§’ã®å ´åˆ:
  contentDuration = 10 (ãƒšãƒ¼ã‚¸æ•°)
  transcriptionDuration = 15 (ç§’)

  è¨ˆç®—: 15 / (10 / 60) = 15 / 0.167 = 90ç§’/åˆ† â† æ„å‘³ä¸æ˜
  æ­£è§£: 15 / 10 = 1.5ç§’/ãƒšãƒ¼ã‚¸ â† æ­£ã—ã„
```

**å½±éŸ¿:**
- PDFçµ±è¨ˆãŒå®Œå…¨ã«é–“é•ã£ãŸå€¤ã«ãªã‚‹
- æ¨å®šæ™‚é–“ãŒå®Ÿéš›ã¨å¤§ããä¹–é›¢
- å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒã‚ã£ã¦ã‚‚ä½¿ãˆãªã„

### å•é¡Œ3: æ–‡å­—èµ·ã“ã—ã¨è¦ç´„ãŒåˆ†ã‘ã¦è¨˜éŒ²ã•ã‚Œã¦ã„ãªã„ï¼ˆPDFã®ã¿ï¼‰

**ç¾çŠ¶:**
- YouTube/Audio: âœ… æ–‡å­—èµ·ã“ã—ã¨è¦ç´„ã‚’åˆ†ã‘ã¦è¨˜éŒ²
- PDF: âŒ è¨˜éŒ²è‡ªä½“ãŒãªã„

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦æœ›:**
> æ–‡å­—èµ·ã“ã—ã¨è¦ç´„ä½œæˆã«åˆ†ã‘ã¦ã¡ã‚ƒã‚“ã¨è¨˜éŒ²ã—ã¦

**å¿…è¦æ€§:**
- ã©ã®å‡¦ç†ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã‹åˆ†æã§ãã‚‹
- ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®šãŒå¯èƒ½
- ãƒ¢ãƒ‡ãƒ«åˆ¥ã®æ€§èƒ½æ¯”è¼ƒãŒã§ãã‚‹

## å®Ÿè£…å†…å®¹

### 1. PDF contentTypeStats ã®ä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/database/analysis-progress.ts`

**Before:**
```typescript
const transcriptionAverage = records.reduce((sum, r) =>
  sum + r.transcriptionDuration / (r.contentDuration / 60), 0) / records.length;
// å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ã§åŒã˜è¨ˆç®—
```

**After:**
```typescript
if (contentType === 'pdf') {
  // For PDF: contentDuration represents page count, not seconds
  // Calculate seconds per page
  const transcriptionAverage = records.reduce((sum, r) =>
    sum + r.transcriptionDuration / r.contentDuration, 0) / records.length;
  // â†‘ ãƒšãƒ¼ã‚¸æ•°ã§å‰²ã‚‹ï¼ˆ60ã§å‰²ã‚‰ãªã„ï¼‰

  contentTypeStats[contentType] = {
    transcriptionAverage, // seconds per page
    summaryAverage,       // seconds per page
    sampleSize: records.length
  };
} else {
  // For video/audio: contentDuration is in seconds, calculate seconds per minute
  const transcriptionAverage = records.reduce((sum, r) =>
    sum + r.transcriptionDuration / (r.contentDuration / 60), 0) / records.length;
  // â†‘ ç§’â†’åˆ†ã«å¤‰æ›ã—ã¦ã‹ã‚‰å‰²ã‚‹

  contentTypeStats[contentType] = {
    transcriptionAverage, // seconds per minute
    summaryAverage,       // seconds per minute
    sampleSize: records.length
  };
}
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- PDF: `contentDuration` = ãƒšãƒ¼ã‚¸æ•° â†’ `ç§’/ãƒšãƒ¼ã‚¸`ã§è¨ˆç®—
- Video/Audio: `contentDuration` = ç§’ â†’ `ç§’/åˆ†`ã§è¨ˆç®—
- ã‚³ãƒ¡ãƒ³ãƒˆã§å˜ä½ã‚’æ˜ç¤º

### 2. PDFã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®å±¥æ­´è¨˜éŒ²è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/server.ts` (/api/analyze-pdf)

#### 2-1. é€²æ—ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä½œæˆ

**è¿½åŠ ç®‡æ‰€:** PDF text extraction ç›´å¾Œ

```typescript
// Create progress tracking record
// IMPORTANT: For PDF, contentDuration represents page count, not seconds
let progressId: string | undefined; // Declare outside try-catch for error handling

try {
  progressId = analysisProgressDB.createRecord(
    'pdf',
    pdfContent.pageCount,  // Use page count as "duration" for PDF
    'pdf-parse',           // PDF doesn't use Whisper, just text extraction
    gptModel,
    pdfContent.fullText.length, // Content length in characters
    undefined,             // No audio quality for PDF
    language
  );
  console.log(`ğŸ“Š Created progress tracking record: ${progressId}`);
} catch (err) {
  console.warn('Failed to create progress tracking record:', err);
}
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- `contentDuration` ã«ãƒšãƒ¼ã‚¸æ•°ã‚’æ¸¡ã™ï¼ˆç§’ã§ã¯ãªã„ï¼‰
- `transcriptionModel` ã« `'pdf-parse'` ã‚’æŒ‡å®šï¼ˆWhisperã§ã¯ãªã„ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ try-catch ä½¿ç”¨

#### 2-2. æŠ½å‡ºæ™‚é–“ã®è¨˜éŒ²

**è¿½åŠ ç®‡æ‰€:** PDF text extraction å®Œäº†å¾Œ

```typescript
// Update transcription (extraction) progress
if (progressId) {
  try {
    analysisProgressDB.updateTranscriptionProgress(
      progressId,
      extractionStartTime.toISOString(),
      extractionEndTime.toISOString()
    );
    console.log(`ğŸ“Š Updated extraction progress: ${extractionDuration}s for ${pdfContent.pageCount} pages`);
  } catch (err) {
    console.warn('Failed to update extraction progress:', err);
  }
}
```

**è¨˜éŒ²å†…å®¹:**
- æŠ½å‡ºé–‹å§‹æ™‚åˆ»
- æŠ½å‡ºçµ‚äº†æ™‚åˆ»
- è‡ªå‹•è¨ˆç®—ã•ã‚Œã‚‹æŠ½å‡ºæ™‚é–“ï¼ˆç§’ï¼‰

#### 2-3. è¦ç´„æ™‚é–“ã®è¨˜éŒ²ï¼ˆé–‹å§‹ï¼‰

**è¿½åŠ ç®‡æ‰€:** Summary generation é–‹å§‹æ™‚

```typescript
// Update summary progress - start time
if (progressId) {
  try {
    analysisProgressDB.updateSummaryProgress(progressId, summaryStartTime.toISOString());
  } catch (err) {
    console.warn('Failed to update summary progress (start):', err);
  }
}
```

#### 2-4. è¦ç´„æ™‚é–“ã®è¨˜éŒ²ï¼ˆçµ‚äº†ãƒ»æˆåŠŸæ™‚ï¼‰

**è¿½åŠ ç®‡æ‰€:** Summary generation æˆåŠŸå¾Œ

```typescript
// Update summary progress - end time
if (progressId && summaryStartTime) {
  try {
    analysisProgressDB.updateSummaryProgress(
      progressId,
      summaryStartTime.toISOString(),
      summaryEndTime.toISOString()
    );
    const summaryDurationForLog = Math.round((summaryEndTime.getTime() - summaryStartTime.getTime()) / 1000);
    console.log(`ğŸ“Š Updated summary progress: ${summaryDurationForLog}s`);
  } catch (err) {
    console.warn('Failed to update summary progress (end):', err);
  }
}
```

#### 2-5. è¦ç´„æ™‚é–“ã®è¨˜éŒ²ï¼ˆçµ‚äº†ãƒ»ã‚¨ãƒ©ãƒ¼æ™‚ï¼‰

**è¿½åŠ ç®‡æ‰€:** Summary generation ã‚¨ãƒ©ãƒ¼å¾Œï¼ˆfallback summaryï¼‰

```typescript
// Update summary progress - end time (even on error)
if (progressId && summaryStartTime) {
  try {
    analysisProgressDB.updateSummaryProgress(
      progressId,
      summaryStartTime.toISOString(),
      summaryEndTime.toISOString()
    );
  } catch (err) {
    console.warn('Failed to update summary progress (error case):', err);
  }
}
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- ã‚¨ãƒ©ãƒ¼æ™‚ã§ã‚‚è¦ç´„æ™‚é–“ã‚’è¨˜éŒ²
- Fallback summaryã®æ™‚é–“ã‚‚çµ±è¨ˆã«å«ã¾ã‚Œã‚‹

#### 2-6. åˆ†æå®Œäº†ã®è¨˜éŒ²ï¼ˆæˆåŠŸæ™‚ï¼‰

**è¿½åŠ ç®‡æ‰€:** Response é€ä¿¡ç›´å‰

```typescript
// Complete progress tracking
if (progressId) {
  try {
    analysisProgressDB.completeAnalysis(progressId, true);
    console.log(`ğŸ“Š Completed progress tracking: ${progressId}`);
  } catch (err) {
    console.warn('Failed to complete progress tracking:', err);
  }
}
```

#### 2-7. åˆ†æå®Œäº†ã®è¨˜éŒ²ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ï¼‰

**è¿½åŠ ç®‡æ‰€:** Error handling å†…

```typescript
// Complete progress tracking with error
if (progressId) {
  try {
    analysisProgressDB.completeAnalysis(progressId, false, error instanceof Error ? error.message : 'Unknown error');
    console.log(`ğŸ“Š Completed progress tracking with error: ${progressId}`);
  } catch (err) {
    console.warn('Failed to complete progress tracking (error case):', err);
  }
}
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- ã‚¨ãƒ©ãƒ¼æ™‚ã¯ `success: false` ã§è¨˜éŒ²
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚ä¿å­˜

### 3. ã‚¹ã‚³ãƒ¼ãƒ—ä¿®æ­£

**å•é¡Œ:**
```typescript
try {
  let progressId: string | undefined;
  // ... processing ...
} catch (error) {
  // Cannot access progressId here! âŒ
}
```

**ä¿®æ­£:**
```typescript
let progressId: string | undefined; // Declare at function scope
try {
  progressId = analysisProgressDB.createRecord(...);
  // ... processing ...
} catch (error) {
  // Can access progressId for error tracking âœ…
  analysisProgressDB.completeAnalysis(progressId, false, error.message);
}
```

**ç†ç”±:**
- ã‚¨ãƒ©ãƒ¼æ™‚ã«ã‚‚é€²æ—ã‚’è¨˜éŒ²ã™ã‚‹ãŸã‚
- try-catch å¤–ã§å®£è¨€ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
PDF Analysis Start
  â†“
createRecord(contentType='pdf', contentDuration=pageCount)
  â†’ Record created in history/analysis-progress.json
  â†“
Extract PDF Text (pdfParse)
  â†“
updateTranscriptionProgress(startTime, endTime)
  â†’ Extraction time recorded (e.g., 15 seconds for 10 pages)
  â†“
Generate Summary (GPT-4)
  â†“
updateSummaryProgress(startTime)
  â†’ Summary start time recorded
  â†“
Summary Complete
  â†“
updateSummaryProgress(startTime, endTime)
  â†’ Summary time recorded (e.g., 25 seconds)
  â†“
completeAnalysis(success=true)
  â†’ Record marked as successful
  â†“
Data saved to history/analysis-progress.json
  â†“
Future estimates use this historical data
  â†’ calculateProcessingTime() reads from analysisProgressDB.getAnalysisStats()
  â†’ Uses PDF-specific stats with seconds per page
```

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### 1. å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®è“„ç©

**Before:**
```
PDFå‡¦ç†å›æ•°: 0å›
æ¨å®šæ™‚é–“: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ (1.5ç§’/ãƒšãƒ¼ã‚¸)
ä¿¡é ¼åº¦: ä½ã„ (å¸¸ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
```

**After (10å›å‡¦ç†å¾Œ):**
```json
{
  "contentTypeStats": {
    "pdf": {
      "transcriptionAverage": 1.2,  // å®Ÿæ¸¬å¹³å‡ 1.2ç§’/ãƒšãƒ¼ã‚¸
      "summaryAverage": 2.5,        // å®Ÿæ¸¬å¹³å‡ 2.5ç§’/ãƒšãƒ¼ã‚¸
      "sampleSize": 10              // 10å€‹ã®ã‚µãƒ³ãƒ—ãƒ«
    }
  }
}
```

**æ¨å®šæ™‚é–“:**
```
10ãƒšãƒ¼ã‚¸ã®PDF:
  æŠ½å‡º: 1.2ç§’/ãƒšãƒ¼ã‚¸ Ã— 10 = 12ç§’
  è¦ç´„: 2.5ç§’/ãƒšãƒ¼ã‚¸ Ã— 10 = 25ç§’
  åˆè¨ˆ: 37ç§’
  ä¿¡é ¼åº¦: ä¸­ã€œé«˜ (10ã‚µãƒ³ãƒ—ãƒ«)
  ãƒãƒƒã‚¸: "âœ“ éå»ã®å®Ÿç¸¾ã‹ã‚‰ç®—å‡º"
```

### 2. ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—åˆ¥ã®æ­£ç¢ºãªæ¨å®š

**YouTube å‹•ç”» (10åˆ†):**
```
æ¨å®šæ™‚é–“:
  æ–‡å­—èµ·ã“ã—: 12ç§’/åˆ† Ã— 10åˆ† = 120ç§’ (2åˆ†)
  è¦ç´„: 30ç§’/åˆ† Ã— 10åˆ† = 300ç§’ (5åˆ†)
  åˆè¨ˆ: 7åˆ†
  è¡¨ç¤º: "å‹•ç”»1åˆ†ã‚ãŸã‚Š12ç§’" / "å‹•ç”»1åˆ†ã‚ãŸã‚Š30ç§’"
```

**PDF (10ãƒšãƒ¼ã‚¸):**
```
æ¨å®šæ™‚é–“:
  æŠ½å‡º: 1.2ç§’/ãƒšãƒ¼ã‚¸ Ã— 10 = 12ç§’
  è¦ç´„: 2.5ç§’/ãƒšãƒ¼ã‚¸ Ã— 10 = 25ç§’
  åˆè¨ˆ: 37ç§’
  è¡¨ç¤º: "1.2ç§’/ãƒšãƒ¼ã‚¸" / "2.5ç§’/ãƒšãƒ¼ã‚¸"
```

### 3. æ–‡å­—èµ·ã“ã—ã¨è¦ç´„ã®åˆ†é›¢

**åˆ†æçµæœã®ä¾‹:**
```
ãƒ¢ãƒ‡ãƒ«åˆ¥çµ±è¨ˆ:
  gpt-4o-mini:
    è¦ç´„é€Ÿåº¦: 2.5ç§’/ãƒšãƒ¼ã‚¸
    ã‚µãƒ³ãƒ—ãƒ«æ•°: 10

  gpt-4o:
    è¦ç´„é€Ÿåº¦: 4.5ç§’/ãƒšãƒ¼ã‚¸
    ã‚µãƒ³ãƒ—ãƒ«æ•°: 5

â†’ gpt-4o-mini ã®æ–¹ãŒ1.8å€é€Ÿã„ï¼
```

**ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®š:**
```
100ãƒšãƒ¼ã‚¸ã®PDF:
  æŠ½å‡ºæ™‚é–“: 120ç§’ (1.2ç§’/ãƒšãƒ¼ã‚¸ Ã— 100)
  è¦ç´„æ™‚é–“: 250ç§’ (2.5ç§’/ãƒšãƒ¼ã‚¸ Ã— 100)

â†’ è¦ç´„ç”ŸæˆãŒãƒœãƒˆãƒ«ãƒãƒƒã‚¯ï¼ˆå…¨ä½“ã®67%ï¼‰
â†’ GPTãƒ¢ãƒ‡ãƒ«ã®æœ€é©åŒ–ãŒåŠ¹æœçš„
```

### 4. çµŒé¨“ã‹ã‚‰å­¦ç¿’

**1å›ç›®ã®å‡¦ç†:**
```
æ¨å®š: 1.5ç§’/ãƒšãƒ¼ã‚¸ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
å®Ÿéš›: 1.8ç§’/ãƒšãƒ¼ã‚¸
â†’ 20%ã®ã‚ºãƒ¬
â†’ ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²
```

**10å›ç›®ã®å‡¦ç†:**
```
æ¨å®š: 1.75ç§’/ãƒšãƒ¼ã‚¸ (å±¥æ­´å¹³å‡)
å®Ÿéš›: 1.8ç§’/ãƒšãƒ¼ã‚¸
â†’ 3%ã®ã‚ºãƒ¬
â†’ ç²¾åº¦å‘ä¸Šï¼
```

## æŠ€è¡“çš„è©³ç´°

### å±¥æ­´ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

**history/analysis-progress.json:**
```json
{
  "id": "analysis_1634567890123_xyz",
  "contentType": "pdf",
  "contentDuration": 10,  // ãƒšãƒ¼ã‚¸æ•°
  "transcriptionModel": "pdf-parse",
  "gptModel": "gpt-4o-mini",
  "transcriptionStartTime": "2025-10-24T08:00:00Z",
  "transcriptionEndTime": "2025-10-24T08:00:12Z",
  "transcriptionDuration": 12,  // 12ç§’
  "summaryStartTime": "2025-10-24T08:00:12Z",
  "summaryEndTime": "2025-10-24T08:00:37Z",
  "summaryDuration": 25,  // 25ç§’
  "contentLength": 5000,  // æ–‡å­—æ•°
  "success": true
}
```

### çµ±è¨ˆè¨ˆç®—

**PDF (contentType === 'pdf'):**
```typescript
// contentDuration = ãƒšãƒ¼ã‚¸æ•° (e.g., 10)
// transcriptionDuration = æŠ½å‡ºæ™‚é–“ (e.g., 12ç§’)
transcriptionAverage = 12 / 10 = 1.2ç§’/ãƒšãƒ¼ã‚¸
```

**YouTube (contentType === 'youtube'):**
```typescript
// contentDuration = ç§’ (e.g., 600ç§’ = 10åˆ†)
// transcriptionDuration = æ–‡å­—èµ·ã“ã—æ™‚é–“ (e.g., 120ç§’)
transcriptionAverage = 120 / (600 / 60) = 120 / 10 = 12ç§’/åˆ†
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**å…¨ã¦ã®å±¥æ­´è¨˜éŒ²å‘¼ã³å‡ºã—ã« try-catch:**
```typescript
try {
  analysisProgressDB.createRecord(...);
} catch (err) {
  console.warn('Failed to create progress tracking record:', err);
  // ã‚¨ãƒ©ãƒ¼ã§ã‚‚å‡¦ç†ã¯ç¶™ç¶šï¼ˆå±¥æ­´è¨˜éŒ²ã¯å¿…é ˆã§ã¯ãªã„ï¼‰
}
```

**ç†ç”±:**
- å±¥æ­´è¨˜éŒ²ã®å¤±æ•—ã§å‡¦ç†å…¨ä½“ã‚’æ­¢ã‚ãªã„
- ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½ï¼ˆPDFè§£æï¼‰ã¯å¸¸ã«å‹•ä½œ
- ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã§å•é¡Œã‚’æŠŠæ¡

## æ¤œè¨¼

### ãƒ“ãƒ«ãƒ‰
- âœ… `npm run build`: æˆåŠŸ
- âœ… `npm run type-check`: æˆåŠŸ

### å¤‰æ›´ã®å®‰å…¨æ€§
- PDF endpoint ã«è¨˜éŒ²æ©Ÿèƒ½è¿½åŠ ï¼ˆæ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿ãªã—ï¼‰
- contentTypeStats è¨ˆç®—ä¿®æ­£ï¼ˆPDFçµ±è¨ˆãŒæ­£ç¢ºã«ï¼‰
- ã‚¹ã‚³ãƒ¼ãƒ—ä¿®æ­£ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ”¹å–„ï¼‰
- å¾Œæ–¹äº’æ›æ€§ã‚ã‚Š

### ãƒ†ã‚¹ãƒˆæ¨å¥¨é …ç›®
- [ ] PDFã‚’å‡¦ç†ã—ã¦ history/analysis-progress.json ã«ãƒ‡ãƒ¼ã‚¿ãŒè¨˜éŒ²ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] 2å›ç›®ã®PDFå‡¦ç†ã§å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒä½¿ã‚ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] "âœ“ éå»ã®å®Ÿç¸¾ã‹ã‚‰ç®—å‡º" ãƒãƒƒã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] PDF ã¨ YouTube ã§ç•°ãªã‚‹è¡¨ç¤ºå˜ä½ï¼ˆç§’/ãƒšãƒ¼ã‚¸ vs å‹•ç”»1åˆ†ã‚ãŸã‚Šç§’ï¼‰ã‚’ç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã§ã‚‚å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒè¨˜éŒ²ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

## ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´

1. `src/database/analysis-progress.ts`: PDF vs Video/Audio ã®è¨ˆç®—åˆ†é›¢
2. `src/server.ts`: PDF endpoint ã¸ã®å±¥æ­´è¨˜éŒ²è¿½åŠ 

**å¤‰æ›´è¡Œæ•°:**
- +124 insertions
- -19 deletions

## ã¾ã¨ã‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦æœ›ã€Œéå»ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦æ¨å®šæ™‚é–“ã‚’å‡ºã™ã€ã€Œæ–‡å­—èµ·ã“ã—ã¨è¦ç´„ã‚’åˆ†ã‘ã¦è¨˜éŒ²ã€ã€Œå‹•ç”»ã¨æ–‡æ›¸ã§ç•°ãªã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã€ã‚’å…¨ã¦å®Ÿè£…ã—ã¾ã—ãŸã€‚

**ä¸»ãªæ”¹å–„:**
1. âœ… PDF ã®å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒè¨˜éŒ²ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸ
2. âœ… PDF ã¨ Video/Audio ã§ç•°ãªã‚‹è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç§’/ãƒšãƒ¼ã‚¸ vs ç§’/åˆ†ï¼‰
3. âœ… æ–‡å­—èµ·ã“ã—ï¼ˆæŠ½å‡ºï¼‰ã¨è¦ç´„ã‚’åˆ†ã‘ã¦è¨˜éŒ²
4. âœ… çµŒé¨“ã‹ã‚‰å­¦ç¿’ã—ã€æ¨å®šç²¾åº¦ãŒå‘ä¸Š

**åŠ¹æœ:**
- PDFã‚’å‡¦ç†ã™ã‚‹ãŸã³ã«æ¨å®šæ™‚é–“ãŒæ­£ç¢ºã«ãªã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä¿¡é ¼ã§ãã‚‹æ¨å®šæ™‚é–“ã‚’è¦‹ã‚‰ã‚Œã‚‹
- ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æãŒå¯èƒ½
- ãƒ¢ãƒ‡ãƒ«åˆ¥ã®æ€§èƒ½æ¯”è¼ƒãŒã§ãã‚‹
