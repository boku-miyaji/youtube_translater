# Commit Summary: PDF URL Cost Estimation

**Commit Hash**: b0cb84d
**Date**: 2025-10-24 22:18:11
**Type**: feat

## 概要

PDF URLを入力した際に、YouTube URLと同様に推定コストと処理時間が表示されるように機能を追加しました。

## 問題

- YouTube URLでは事前に推定コストと処理時間が表示されていた
- しかし、PDF URLを入力しても何も表示されなかった
- ユーザーが事前にコストや時間を把握できない状態だった

## 実装内容

### バックエンド（server.ts）

1. **`/api/estimate-cost-pdf` エンドポイントの強化**
   - URLパラメータが提供された場合、実際にPDFをダウンロードして解析
   - `downloadPDF()` と `extractPDFText()` を使用して実際のページ数を取得
   - デフォルト値（10ページ）を使用する代わりに、実際のページ数で推定
   - エラー時はフォールバックとしてデフォルト値を使用

2. **処理時間計算の統一**
   - 手動計算から `calculateProcessingTime()` 関数の使用に変更
   - YouTube動画と同じロジックで履歴データを活用
   - PDF用の正規化（ページベース）を自動的に適用

### フロントエンド（AnalyzePage.tsx）

1. **`estimateCostForPDFUrl` 関数の追加**
   - YouTube URL用の `estimateCostForUrl` 関数と同様の構造
   - `/api/estimate-cost-pdf` エンドポイントを呼び出し
   - レスポンスから `costEstimation` と `estimatedProcessingTime` を設定
   - エラーハンドリングとデバッグログを完備

2. **イベントハンドラへの組み込み**
   - `handleUrlChange`: PDF URLが検出されたら200ms後に推定を開始
   - `handleUrlPaste`: PDF URLが貼り付けられたら推定を開始
   - YouTube URLと同じ遅延時間（200ms）で一貫性を確保

## 変更の詳細

### 変更されたファイル
- `src/server.ts`: 84行の変更（+62, -22）
- `src/components/pages/AnalyzePage.tsx`: 76行の変更（+59, -17）

### 主な追加機能
- PDF URLからの実際のページ数取得
- 履歴データを活用した処理時間推定
- ページベースの正規化による正確な推定
- YouTube URLと同じUIでの推定結果表示

## テスト結果

- ✅ TypeScript型チェック通過
- ✅ ビルド成功
- ✅ PDF URL入力時に推定が表示されることを確認

## 影響範囲

- PDF URL入力時のユーザー体験が向上
- YouTube URLと同じレベルの情報提供が可能に
- 既存のYouTube URL機能には影響なし
- 後方互換性を維持（pageCountパラメータも引き続き使用可能）
