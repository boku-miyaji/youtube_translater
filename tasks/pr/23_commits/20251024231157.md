# Commit Summary: Fix PDF Default Processing Speed

**Commit Hash**: 3837b28
**Date**: 2025-10-24 23:11:57
**Type**: fix

## 概要

PDFのデフォルト処理速度が動画用の係数を流用していたため、推定時間が実際と大きくかけ離れていた問題を修正しました。

## 問題

23ページのPDFの処理時間推定:
- **予測**: 18分59秒
- **実際**: 21秒

**差**: 約54倍もの誤差！

### 詳細な内訳

**予測値（修正前）**:
- テキスト抽出: 35秒（1.5秒/ページ）
- 要約生成: 18分24秒（48秒/ページ）
- 合計: 18分59秒

**実際値**:
- テキスト抽出: 0.1秒
- 要約生成: 21秒（約0.9秒/ページ）
- 合計: 21.1秒

## 原因

### 1. 動画用の係数をPDFに流用

```typescript
// 修正前
const summarySpeed = processingSpeed.summary[gptModel] || 0.8;
const secondsPerPage = summarySpeed * 60; // 0.8 * 60 = 48秒/ページ
```

この`summarySpeed`は**動画用の係数**で、「動画1分を要約するのに0.8分かかる」という意味です。これをPDFに適用するため60倍し、48秒/ページという非現実的な値になっていました。

### 2. 過度に保守的な抽出時間

PDFのテキスト抽出は非常に高速（実際0.1秒/ページ）ですが、デフォルトが1.5秒/ページと15倍も高く設定されていました。

## 実装内容

### 修正後の係数

```typescript
// テキスト抽出
const secondsPerPage = 0.5; // 1.5 → 0.5秒/ページ

// 要約生成
const secondsPerPage = gptModel.includes('gpt-4o-mini') ? 1.5 : 3.0;
// 48秒/ページ → gpt-4o-mini: 1.5秒/ページ、gpt-4o: 3秒/ページ
```

### 根拠

- **テキスト抽出**: 実測0.1秒/ページ、余裕を見て0.5秒
- **要約生成**: 実測0.9秒/ページ(gpt-4o-mini)、余裕を見て1.5秒
- PDFはテキストが既に抽出されているため、動画より遥かに高速

## 結果

23ページPDFの新しい推定値:
- テキスト抽出: 12秒（23 × 0.5秒）
- 要約生成: 35秒（23 × 1.5秒）
- **合計: 47秒**

実際の21秒に対して、18分59秒から47秒へと大幅に改善！

## 補足

- これは**デフォルト値**です
- PDFを2件以上処理すると、**履歴データ**を使った推定に切り替わります
- 履歴データを使えばさらに精度が向上します

## 変更の詳細

### 変更されたファイル
- `src/server.ts`: 13行の変更（+6, -7）

### 影響範囲
- PDF URL入力時の推定時間が現実的に
- PDF解析完了後の次回推定も改善
- 動画の推定には影響なし
