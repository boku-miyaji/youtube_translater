# å®Ÿè£…å·®åˆ†ãƒ¬ãƒãƒ¼ãƒˆ - PDFåˆ†ææ™‚é–“ãƒ»ã‚³ã‚¹ãƒˆè¡¨ç¤ºä¿®æ­£ï¼ˆIssue 20ï¼‰

## å•é¡Œã®è©³ç´°

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- **ç—‡çŠ¶**: PDFåˆ†ææ™‚ã«ä»¥ä¸‹ã®è¡¨ç¤ºãŒæ­£ã—ãå‹•ä½œã—ãªã„
  - æ–‡å­—èµ·ã“ã—å‡¦ç†æ™‚é–“: "è¨ˆæ¸¬ä¸­..." ã¨è¡¨ç¤º
  - æ‰€è¦æ™‚é–“: "è¨ˆæ¸¬ä¸­..." ã¨è¡¨ç¤º
  - è§£ææ™‚é–“ã®é–‹å§‹ãƒ»çµ‚äº†: "ä¸æ˜" ã¨è¡¨ç¤º
  - åˆ†æã‚³ã‚¹ãƒˆï¼ˆå®Ÿç¸¾ï¼‰ã®å‡¦ç†æ™‚é–“: "è¨ˆæ¸¬ä¸­..." ã¨è¡¨ç¤º

### æ ¹æœ¬åŸå› ã®åˆ†æ
1. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã®ä¸æ•´åˆ**: PDFç”¨ã®`analysisTime.extraction`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã¯ãªãã€`analysisTime.duration`ã‚’å‚ç…§ã—ã¦ã„ãŸ
2. **ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ã®ä¸è¶³**: PDFãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«`startTime`/`endTime`ãªã©ã®åŸºæœ¬ã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±ãŒä¸è¶³
3. **å‹å®šç¾©ã®ä¸æ•´åˆ**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹ã¨å±¥æ­´ä¿å­˜é–¢æ•°ã®æœŸå¾…ã™ã‚‹å‹ãŒä¸€è‡´ã—ã¦ã„ãªã„

## å®Ÿè£…ã—ãŸä¿®æ­£å†…å®¹

### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¿®æ­£ï¼ˆAnalyzePage.tsxï¼‰

#### getFirstStageProcessingTimeé–¢æ•°ã®ä¿®æ­£
```typescript
// ä¿®æ­£å‰: PDFã§ã‚‚durationãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‚ç…§
if (currentVideo.analysisTime.duration && currentVideo.analysisTime.duration > 0) {
  return Math.round(currentVideo.analysisTime.duration);
}

// ä¿®æ­£å¾Œ: PDFã§ã¯extractionãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‚ç…§
if (currentVideo.analysisTime.extraction && currentVideo.analysisTime.extraction > 0) {
  return Math.round(currentVideo.analysisTime.extraction);
}
```

#### formatSafeDurationé–¢æ•°ã®æ”¹å–„
```typescript
// PDFç”¨ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’è¿½åŠ 
let effectiveDuration = duration;
if ((!duration || isNaN(duration) || duration <= 0) && isPdfContent(currentVideo) && currentVideo?.analysisTime?.total) {
  effectiveDuration = currentVideo.analysisTime.total;
}
```

### 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä¿®æ­£ï¼ˆserver.tsï¼‰

#### PDFåˆ†æãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ”¹å–„
```typescript
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®analysisTimeã«å®Œå…¨ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±ã‚’è¿½åŠ 
analysisTime: {
  startTime: analysisStartTime.toISOString(),
  endTime: analysisEndTime.toISOString(),
  duration: totalAnalysisTime,
  extraction: extractionDuration,
  summary: summaryDuration,
  total: totalAnalysisTime
}
```

#### addToHistoryé–¢æ•°ã®å‹æ‹¡å¼µ
```typescript
// ã‚ˆã‚ŠæŸ”è»Ÿãªå‹å®šç¾©ã«å¤‰æ›´
analysisTime: { 
  startTime: string; 
  endTime: string; 
  duration: number;
  transcription?: number;
  extraction?: number;  // PDFç”¨
  summary?: number;
  total?: number;
} | null = null
```

### 3. å‹å®šç¾©ä¿®æ­£ï¼ˆtypes/index.tsï¼‰

#### PDFAnalysisResponseã®æ‹¡å¼µ
```typescript
analysisTime?: {
  startTime?: string;     // è¿½åŠ 
  endTime?: string;       // è¿½åŠ 
  duration?: number;      // è¿½åŠ 
  extraction?: number;
  transcription?: number;
  summary: number;
  total: number;
};
```

## æŠ€è¡“çš„ãªæ”¹å–„å†…å®¹

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ”¹å–„
- **PDFè§£æé–‹å§‹** â†’ ã‚µãƒ¼ãƒãƒ¼ã§å®Œå…¨ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±ã‚’è¨˜éŒ²
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ** â†’ å…¨ã¦ã®å¿…è¦ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å«ã‚ã‚‹
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤º** â†’ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦é©åˆ‡ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‚ç…§

### 2. å‹å®‰å…¨æ€§ã®å‘ä¸Š
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹ã¨ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ã®æ•´åˆæ€§ã‚’ç¢ºä¿
- è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ï¼ˆå‹•ç”»ãƒ»éŸ³å£°ãƒ»PDFï¼‰ã«å¯¾å¿œã™ã‚‹çµ±ä¸€å‹ã‚’å°å…¥
- Optional fieldsã‚’é©åˆ‡ã«ä½¿ç”¨ã—ã¦ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã‚’é˜²æ­¢

### 3. è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã®å …ç‰¢æ€§å‘ä¸Š
- PDFç‰¹æœ‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ§‹é€ ã«å¯¾å¿œã—ãŸãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
- ç„¡åŠ¹ãªå€¤ã®é©åˆ‡ãªæ¤œè¨¼ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤å‡¦ç†
- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—åˆ¤å®šã®æ”¹å–„

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®æ”¹å–„
- âœ… PDFåˆ†ææ™‚ã®æ­£ç¢ºãªã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±è¡¨ç¤º
- âœ… å®Ÿéš›ã®å‡¦ç†æ™‚é–“ã®å¯è¦–åŒ–
- âœ… åˆ†æã‚³ã‚¹ãƒˆã®è©³ç´°æƒ…å ±è¡¨ç¤º
- âœ… ä¸€è²«ã—ãŸè¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### 2. ã‚·ã‚¹ãƒ†ãƒ ã®å …ç‰¢æ€§å‘ä¸Š
- ğŸ› ï¸ å‹å®‰å…¨æ€§ã®å‘ä¸Šã«ã‚ˆã‚‹ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼å‰Šæ¸›
- ğŸ› ï¸ è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ã®çµ±ä¸€çš„ãªå‡¦ç†
- ğŸ› ï¸ å°†æ¥ã®æ‹¡å¼µã«å¯¾å¿œã—ã‚„ã™ã„æŸ”è»Ÿãªå‹è¨­è¨ˆ

### 3. é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ä½“é¨“ã®æ”¹å–„
- ğŸ” ã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±ã®è©³ç´°ãƒ­ã‚°å‡ºåŠ›
- ğŸ” å‹ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹æ—©æœŸã‚¨ãƒ©ãƒ¼æ¤œå‡º
- ğŸ” æ˜ç¢ºãªãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¿½è·¡

## å½±éŸ¿ç¯„å›²ã¨ãƒ†ã‚¹ãƒˆæ¨å¥¨é …ç›®

### å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«
- **src/components/pages/AnalyzePage.tsx**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯
- **src/server.ts**: PDFãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‡¦ç†ã¨addToHistoryé–¢æ•°
- **src/types/index.ts**: TypeScriptå‹å®šç¾©

### ãƒ†ã‚¹ãƒˆæ¨å¥¨é …ç›®

1. **PDFåˆ†æã®å®Œå…¨ãƒ•ãƒ­ãƒ¼ç¢ºèª**
   - PDF URLã‹ã‚‰ã®åˆ†æ
   - PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‹ã‚‰ã®åˆ†æ
   - ã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±ã®æ­£ç¢ºãªè¡¨ç¤ºç¢ºèª

2. **ä»–ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ã¸ã®å½±éŸ¿ç¢ºèª**
   - YouTubeå‹•ç”»åˆ†æãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨
   - éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«åˆ†æãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨
   - æ—¢å­˜ã®å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤ºã«å•é¡ŒãŒãªã„ã“ã¨

3. **ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ç¢ºèª**
   - ç„¡åŠ¹ãªPDFãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã®è¡¨ç¤º
   - ä¸å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ã§ã®è¡¨ç¤ºå‹•ä½œ

## ã‚³ãƒŸãƒƒãƒˆæƒ…å ±

- **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥**: de7f779
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: "fix: Fix PDF analysis timing and cost display issues"
- **å®Ÿè£…æ—¥æ™‚**: 2025-07-22 08:42:15 UTC

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€PDFåˆ†ææ™‚ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±ã¨ã‚³ã‚¹ãƒˆæƒ…å ±ãŒæ­£ç¢ºã«è¡¨ç¤ºã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯åˆ†æã®é€²è¡ŒçŠ¶æ³ã¨çµæœã‚’é©åˆ‡ã«æŠŠæ¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚