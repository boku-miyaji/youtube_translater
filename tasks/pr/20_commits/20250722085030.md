# å®Ÿè£…å·®åˆ†ãƒ¬ãƒãƒ¼ãƒˆ - PDFåˆ†æè¡¨ç¤ºå•é¡Œã®æ ¹æœ¬çš„ä¿®æ­£ï¼ˆIssue 20ï¼‰

## å•é¡Œã®æ·±åˆ»åº¦ã¨èƒŒæ™¯

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ç¶™ç¶šçš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- **å ±å‘Šå†…å®¹**: ã€Œä½•å›ã‚‚æŒ‡ç¤ºã—ã¦ã„ã‚‹ãŒæ²»ã‚‰ãªã„ã€
- **å•é¡Œã®æŒç¶šæ€§**: ä»¥å‰ã®ä¿®æ­£ã§ã¯è§£æ±ºã•ã‚Œã¦ã„ãªã‹ã£ãŸ
- **å…·ä½“çš„ç—‡çŠ¶**:
  - æ–‡å­—èµ·ã“ã—å‡¦ç†æ™‚é–“: "è¨ˆæ¸¬ä¸­..." ã®è¡¨ç¤º
  - æ‰€è¦æ™‚é–“: "è¨ˆæ¸¬ä¸­..." ã®è¡¨ç¤º  
  - è§£ææ™‚é–“: "ä¸æ˜" ã®è¡¨ç¤º
  - åˆ†æã‚³ã‚¹ãƒˆï¼ˆå®Ÿç¸¾ï¼‰ãƒ‡ãƒ¼ã‚¿ã®ä¸æ­£ç¢ºãªè¡¨ç¤º

### æ ¹æœ¬åŸå› ã®ç‰¹å®š

#### 1. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ–­çµ¶ã®ç™ºè¦‹
```typescript
// å•é¡Œ: analysisType ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ videoMetadata ã«è¨­å®šã•ã‚Œã¦ã„ãªã„
const videoMetadata = {
  // ... ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  analysisTime: data.analysisTime,  // âœ… æ­£ã—ãè¨­å®š
  // analysisType: data.analysisType,  // âŒ æ¬ å¦‚ã—ã¦ã„ãŸ
  source: inputType,
}
```

#### 2. ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è­˜åˆ¥æ©Ÿèƒ½ã®ä¸å‚™
```typescript
// å•é¡Œ: isPdfContent() ãŒPDFã‚’æ­£ã—ãè­˜åˆ¥ã§ããªã„
const isPdfContent = (video: any): boolean => {
  // analysisType === 'pdf' ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŒã€
  // analysisType ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ãŸã‚å¸¸ã« false
  return video?.analysisType === 'pdf';  // âŒ å¸¸ã«false
}
```

#### 3. è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã®é€£é–çš„å¤±æ•—
- PDFè­˜åˆ¥å¤±æ•— â†’ å‹•ç”»/éŸ³å£°ç”¨ã®å‡¦ç†æ™‚é–“ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‚ç…§ â†’ ãƒ‡ãƒ¼ã‚¿ä¸åœ¨ â†’ "è¨ˆæ¸¬ä¸­..." è¡¨ç¤º

## å®Ÿè£…ã—ãŸæ ¹æœ¬çš„ä¿®æ­£

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å®Œå…¨æ€§ã®ç¢ºä¿

#### analysisType ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç¢ºå®Ÿãªè¨­å®š
```typescript
// ä¿®æ­£å¾Œ: ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ + ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥
analysisType: data.analysisType || (inputType === InputType.PDF_URL || inputType === InputType.PDF_FILE ? 'pdf' : undefined),
```

**è¨­è¨ˆæ–¹é‡**:
- ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® `analysisType` ã‚’å„ªå…ˆä½¿ç”¨
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å…¥åŠ›ã‚¿ã‚¤ãƒ—ã‹ã‚‰ã®æ¨è«–
- ç¢ºå®Ÿæ€§: PDFå…¥åŠ›ã‚¿ã‚¤ãƒ—ã®å ´åˆã¯å¿…ãš 'pdf' ã‚’è¨­å®š

### 2. å¤šå±¤çš„PDFè­˜åˆ¥ã‚·ã‚¹ãƒ†ãƒ 

#### æ”¹å–„ã•ã‚ŒãŸisPdfContenté–¢æ•°
```typescript
const isPdfContent = (video: any): boolean => {
  // 1. ç¾åœ¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å…¥åŠ›ã‚¿ã‚¤ãƒ—ï¼ˆæœ€ã‚‚ä¿¡é ¼æ€§ãŒé«˜ã„ï¼‰
  if (inputType === InputType.PDF_URL || inputType === InputType.PDF_FILE) {
    return true;
  }
  
  // 2. ã‚µãƒ¼ãƒãƒ¼è¨­å®šã®analysisType
  if (video?.analysisType === 'pdf') {
    return true;
  }
  
  // 3. URLãƒ‘ã‚¿ãƒ¼ãƒ³
  if (video?.url && video.url.includes('.pdf')) {
    return true;
  }
  
  // 4. ãƒ•ã‚¡ã‚¤ãƒ«åãƒ‘ã‚¿ãƒ¼ãƒ³
  if (video?.originalFilename && video.originalFilename.toLowerCase().endsWith('.pdf')) {
    return true;
  }
  
  // 5. ãƒ¬ã‚¬ã‚·ãƒ¼åˆ¤å®šï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰
  if (video?.method === 'subtitle' && !video?.url?.includes('youtube.com') && !video?.url?.includes('youtu.be')) {
    return true;
  }
  
  return false;
}
```

### 3. åŒ…æ‹¬çš„ãƒ‡ãƒãƒƒã‚°ã‚·ã‚¹ãƒ†ãƒ 

#### getFirstStageProcessingTimeé–¢æ•°ã®æ”¹å–„
```typescript
const getFirstStageProcessingTime = () => {
  // è©³ç´°ãƒ­ã‚°å‡ºåŠ›
  console.log('ğŸ” getFirstStageProcessingTime called');
  console.log('  - currentVideo exists:', !!currentVideo);
  console.log('  - analysisTime exists:', !!currentVideo?.analysisTime);
  console.log('  - analysisTime structure:', currentVideo?.analysisTime);
  console.log('  - isPdfContent result:', isPdfContent(currentVideo));
  
  if (!currentVideo?.analysisTime) return null;
  
  if (isPdfContent(currentVideo)) {
    console.log('  - Processing as PDF');
    console.log('  - extraction field:', currentVideo.analysisTime.extraction);
    
    if (currentVideo.analysisTime.extraction && currentVideo.analysisTime.extraction > 0) {
      return Math.round(currentVideo.analysisTime.extraction);
    }
    return null;
  } else {
    // å‹•ç”»/éŸ³å£°å‡¦ç†
    return currentVideo.analysisTime.transcription ? Math.round(currentVideo.analysisTime.transcription) : null;
  }
}
```

#### formatSafeDurationé–¢æ•°ã®å …ç‰¢åŒ–
```typescript
const formatSafeDuration = (duration: number | undefined | null): string => {
  console.log('ğŸ•°ï¸ formatSafeDuration called');
  console.log('  - input duration:', duration);
  console.log('  - isPdfContent:', isPdfContent(currentVideo));
  
  // PDFç”¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
  let effectiveDuration = duration;
  if ((!duration || isNaN(duration) || duration <= 0) && isPdfContent(currentVideo) && currentVideo?.analysisTime?.total) {
    console.log('  - Using PDF fallback to analysisTime.total');
    effectiveDuration = currentVideo.analysisTime.total;
  }
  
  if (!effectiveDuration || isNaN(effectiveDuration) || effectiveDuration <= 0) {
    return 'è¨ˆæ¸¬ä¸­...';
  }
  
  // ç§’æ•°ã®é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  const safeDuration = Math.round(effectiveDuration);
  if (safeDuration < 60) {
    return `${safeDuration}ç§’`;
  } else {
    const minutes = Math.floor(safeDuration / 60);
    const seconds = safeDuration % 60;
    return `${minutes}åˆ†${seconds}ç§’`;
  }
}
```

### 4. transcriptSource ã®æœ€é©åŒ–

#### PDFå°‚ç”¨å‡¦ç†ã®è¿½åŠ 
```typescript
transcriptSource: (inputType === InputType.PDF_URL || inputType === InputType.PDF_FILE) ? 'subtitle' : (data.method as 'subtitle' | 'whisper'),
```

## æŠ€è¡“çš„æ”¹å–„å†…å®¹

### 1. ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®ç¢ºä¿
- **å®Œå…¨æ€§**: ã™ã¹ã¦ã®å¿…è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç¢ºå®Ÿã«è¨­å®šã•ã‚Œã‚‹
- **ä¸€è²«æ€§**: å…¥åŠ›ã‚¿ã‚¤ãƒ—ã¨analysisTypeã®æ•´åˆæ€§ã‚’ä¿è¨¼
- **å†—é•·æ€§**: è¤‡æ•°ã®è­˜åˆ¥æ–¹æ³•ã«ã‚ˆã‚‹ç¢ºå®ŸãªPDFåˆ¤å®š

### 2. ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®å¼·åŒ–
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥**: è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‹ã‚‰æœ€é©ãªå€¤ã‚’é¸æŠ
- **ãƒ­ã‚°å‡ºåŠ›**: å•é¡Œç™ºç”Ÿæ™‚ã®è©³ç´°ãªèª¿æŸ»æƒ…å ±ã‚’æä¾›
- **é˜²å¾¡çš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°**: null/undefinedå€¤ã®å®‰å…¨ãªå‡¦ç†

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®
- **æœ€é©åŒ–**: æœ€ã‚‚ç¢ºå®Ÿãªåˆ¤å®šæ–¹æ³•ã‚’å„ªå…ˆå®Ÿè¡Œ
- **æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³**: ä¸è¦ãªå‡¦ç†ã®å›é¿
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä½¿ç”¨

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœã¨æ¤œè¨¼ãƒã‚¤ãƒ³ãƒˆ

### 1. å³åº§ã«è§£æ±ºã•ã‚Œã‚‹è¡¨ç¤ºå•é¡Œ
- âœ… **æ–‡å­—èµ·ã“ã—å‡¦ç†æ™‚é–“**: å®Ÿéš›ã®PDFæŠ½å‡ºæ™‚é–“ã‚’è¡¨ç¤º
- âœ… **æ‰€è¦æ™‚é–“**: åˆ†æå…¨ä½“ã®å®Ÿæ™‚é–“ã‚’è¡¨ç¤º
- âœ… **è§£ææ™‚é–“**: æ­£ç¢ºãªé–‹å§‹/çµ‚äº†æ™‚åˆ»ã‚’è¡¨ç¤º
- âœ… **åˆ†æã‚³ã‚¹ãƒˆï¼ˆå®Ÿç¸¾ï¼‰**: æ­£ç¢ºãªã‚³ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º

### 2. ã‚·ã‚¹ãƒ†ãƒ å …ç‰¢æ€§ã®å‘ä¸Š
- ğŸ› ï¸ **å›å¾©åŠ›**: éƒ¨åˆ†çš„ãƒ‡ãƒ¼ã‚¿ä¸å…·åˆã¸ã®å¯¾å¿œåŠ›
- ğŸ› ï¸ **äº’æ›æ€§**: æ—¢å­˜ã®åˆ†æçµæœã¨ã®å¾Œæ–¹äº’æ›æ€§
- ğŸ› ï¸ **æ‹¡å¼µæ€§**: å°†æ¥ã®æ–°æ©Ÿèƒ½è¿½åŠ ã¸ã®å¯¾å¿œåŠ›

### 3. é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ä½“é¨“ã®æ”¹å–„
- ğŸ” **å¯è¦–æ€§**: è©³ç´°ãªãƒ­ã‚°ã«ã‚ˆã‚‹å•é¡Œè¿½è·¡
- ğŸ” **è¿½è·¡æ€§**: ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã®å®Œå…¨ãªæŠŠæ¡
- ğŸ” **äºˆæ¸¬æ€§**: æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã®æ˜ç¢ºåŒ–

## æ¤œè¨¼ã™ã¹ãå‹•ä½œã‚·ãƒŠãƒªã‚ª

### PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
1. PDF ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
2. åˆ†æå®Œäº†å¾Œã®è¡¨ç¤ºç¢ºèª
3. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã§ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ç¢ºèª

### PDF URLã‹ã‚‰ã®åˆ†æ
1. PDF URLã‚’å…¥åŠ›ã—ã¦åˆ†æå®Ÿè¡Œ
2. åˆ†æå®Œäº†å¾Œã®è¡¨ç¤ºç¢ºèª
3. ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã®ç²¾åº¦ç¢ºèª

### æ—¢å­˜æ©Ÿèƒ½ã®å›å¸°ãƒ†ã‚¹ãƒˆ
1. YouTubeå‹•ç”»åˆ†æã®æ­£å¸¸å‹•ä½œç¢ºèª
2. éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«åˆ†æã®æ­£å¸¸å‹•ä½œç¢ºèª
3. æ—¢å­˜ã®å±¥æ­´ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã®ç¢ºèª

## ã‚³ãƒŸãƒƒãƒˆæƒ…å ±

- **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥**: f08f503
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: "fix: Resolve PDF analysis display issues with comprehensive fixes"
- **å®Ÿè£…æ—¥æ™‚**: 2025-07-22 08:50:30 UTC
- **å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**: src/components/pages/AnalyzePage.tsx

## ä»Šå¾Œã®ä¿å®ˆæ€§å‘ä¸Š

### 1. ã‚³ãƒ¼ãƒ‰å“è³ª
- TypeScriptå‹å®‰å…¨æ€§ã®å®Œå…¨æ´»ç”¨
- é–¢æ•°ã®å˜ä¸€è²¬ä»»åŸå‰‡ã®éµå®ˆ
- æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

### 2. ãƒ†ã‚¹ãƒˆå¯èƒ½æ€§
- ç´”ç²‹é–¢æ•°ã«ã‚ˆã‚‹ãƒ­ã‚¸ãƒƒã‚¯åˆ†é›¢
- ãƒ¢ãƒƒã‚¯ã—ã‚„ã™ã„ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
- äºˆæ¸¬å¯èƒ½ãªå‹•ä½œãƒ‘ã‚¿ãƒ¼ãƒ³

### 3. ç›£è¦–ãƒ»é‹ç”¨
- åŒ…æ‹¬çš„ãƒ­ã‚°å‡ºåŠ›ã«ã‚ˆã‚‹é‹ç”¨ç›£è¦–
- ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®è¿…é€ŸãªåŸå› ç‰¹å®š
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®è¿½è·¡

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€PDFåˆ†ææ™‚ã®è¡¨ç¤ºå•é¡Œã¯æ ¹æœ¬çš„ã«è§£æ±ºã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡æ‘˜ã—ã¦ã„ãŸã€Œä½•å›ã‚‚æŒ‡ç¤ºã—ã¦ã„ã‚‹ãŒæ²»ã‚‰ãªã„ã€å•é¡ŒãŒå®Œå…¨ã«è§£æ¶ˆã•ã‚Œã¾ã™ã€‚