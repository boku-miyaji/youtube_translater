# å®Ÿè£…å·®åˆ†ãƒ¬ãƒãƒ¼ãƒˆ - PDFæ™‚é–“è¡¨ç¤ºã®åŒ…æ‹¬çš„ä¿®æ­£ï¼ˆIssue 20ï¼‰

## å•é¡Œã®è©³ç´°

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆ4-reimplementã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ï¼‰
- **å•é¡Œ1**: PDFå‡¦ç†æ™‚é–“ãŒã€Œnanåˆ†nanç§’ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹
- **å•é¡Œ2**: é–‹å§‹æ™‚é–“ãƒ»çµ‚äº†æ™‚é–“ãŒã€Œä¸æ˜ã€ã«ãªã£ã¦ã„ã‚‹  
- **å•é¡Œ3**: æ–‡å­—èµ·ã“ã—ã®å‡¦ç†æ™‚é–“ã‚‚ã€Œè¨ˆæ¸¬ä¸­ã€ã®ã¾ã¾ã«ãªã‚‹

### æ ¹æœ¬åŸå› ã®ç‰¹å®š
1. **analysisTypeãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸è¶³**: æ—¢å­˜ã®PDFãƒ‡ãƒ¼ã‚¿ã«`analysisType`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„
2. **å®‰å…¨ã§ãªã„æ™‚é–“è¨ˆç®—**: `Math.floor(duration / 60)`ãŒ`NaN`ã®å ´åˆã«NaNåˆ†NaNç§’ã‚’è¡¨ç¤º
3. **ä¸å®Œå…¨ãªPDFæ¤œå‡º**: `analysisType`ã«ä¾å­˜ã—ãŸæ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯ãŒæ©Ÿèƒ½ã—ãªã„

## å®Ÿè£…ã—ãŸä¿®æ­£å†…å®¹

### 1. å®‰å…¨ãªæ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°ã®è¿½åŠ 

#### formatSafeDurationé–¢æ•°ã®æ–°è¦ä½œæˆ
```typescript
const formatSafeDuration = (duration: number | undefined | null): string => {
  if (!duration || isNaN(duration) || duration <= 0) {
    return 'è¨ˆæ¸¬ä¸­...';
  }
  
  const safeDuration = Math.round(duration);
  if (safeDuration < 60) {
    return `${safeDuration}ç§’`;
  } else {
    const minutes = Math.floor(safeDuration / 60);
    const seconds = safeDuration % 60;
    return `${minutes}åˆ†${seconds}ç§’`;
  }
}
```

**åŠ¹æœ**: 
- NaNå€¤ã§ã‚‚ã€Œè¨ˆæ¸¬ä¸­...ã€ã¨å®‰å…¨ã«è¡¨ç¤º
- é©åˆ‡ãªåˆ†ç§’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆä¾‹: 16ç§’ã€2åˆ†30ç§’ï¼‰

### 2. å¼·åŒ–ã•ã‚ŒãŸPDFæ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯

#### isPdfContenté–¢æ•°ã®æ–°è¦ä½œæˆ
```typescript
const isPdfContent = (video: any): boolean => {
  if (video?.url && video.url.includes('.pdf')) {
    return true;
  }
  if (video?.method === 'subtitle' && !video?.url?.includes('youtube.com') && !video?.url?.includes('youtu.be')) {
    return true;
  }
  return video?.analysisType === 'pdf';
}
```

**æ¤œå‡ºæ–¹æ³•**:
1. URLå†…ã®`.pdf`ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
2. `method="subtitle"`ã‹ã¤éYouTube URL
3. æ—¢å­˜ã®`analysisType="pdf"`ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰

### 3. ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—æ¤œå‡ºã®æ”¹å–„

#### getFirstStageMethodé–¢æ•°ã®æ›´æ–°
```typescript
// Before: analysisTypeã«ä¾å­˜
const contentType = currentVideo?.analysisType || 'youtube';
switch (contentType) {
  case 'pdf':
    return 'PDF Parser';
  // ...
}

// After: æ”¹è‰¯ã•ã‚ŒãŸPDFæ¤œå‡ºä½¿ç”¨  
if (isPdfContent(currentVideo)) {
  return 'PDF Parser';
} else if (currentVideo?.analysisType === 'audio') {
  return 'Whisper AI';
} else {
  return currentVideo?.transcriptSource === 'subtitle' ? 'YouTubeå­—å¹•' : 'Whisper AI';
}
```

### 4. å‡¦ç†æ™‚é–“è¡¨ç¤ºã®ä¿®æ­£

#### getFirstStageProcessingTimeé–¢æ•°ã®æ›´æ–°
```typescript
// Before: contentType switchæ–‡
const contentType = currentVideo?.analysisType || 'youtube';
switch (contentType) {
  case 'pdf':
    // è¤‡é›‘ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
  // ...
}

// After: ã‚·ãƒ³ãƒ—ãƒ«ãªPDFæ¤œå‡ºãƒ™ãƒ¼ã‚¹
if (isPdfContent(currentVideo)) {
  if (currentVideo.analysisTime.duration && currentVideo.analysisTime.duration > 0) {
    return Math.round(currentVideo.analysisTime.duration);
  }
  return null;
} else {
  return currentVideo.analysisTime.transcription ? Math.round(currentVideo.analysisTime.transcription) : null;
}
```

### 5. ã‚³ã‚¹ãƒˆè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã®çµ±ä¸€

#### PDFç”¨ã‚³ã‚¹ãƒˆè¡¨ç¤ºã®æ›´æ–°
```typescript
// Before: analysisTypeãƒ™ãƒ¼ã‚¹
const contentType = currentVideo?.analysisType || 'youtube';
if (contentType === 'pdf') {
  return 'PDFè§£æ: ç„¡æ–™';
}

// After: isPdfContentãƒ™ãƒ¼ã‚¹
if (isPdfContent(currentVideo)) {
  return 'PDFè§£æ: ç„¡æ–™';
}
```

### 6. æ‰€è¦æ™‚é–“è¡¨ç¤ºã®æ ¹æœ¬ä¿®æ­£

#### å±é™ºãªMath.floorå‡¦ç†ã®ç½®ãæ›ãˆ
```typescript
// Before: ç›´æ¥çš„ã§å±é™ºãªè¨ˆç®—
{currentVideo.analysisTime.duration < 60 ? 
  `${currentVideo.analysisTime.duration}ç§’` : 
  `${Math.floor(currentVideo.analysisTime.duration / 60)}åˆ†${currentVideo.analysisTime.duration % 60}ç§’`
}

// After: å®‰å…¨ãªãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ä½¿ç”¨
{formatSafeDuration(currentVideo.analysisTime.duration)}
```

## æŠ€è¡“çš„æ”¹å–„ç‚¹

### 1. ã‚¨ãƒ©ãƒ¼è€æ€§ã®å‘ä¸Š
- **NaNå€¤ã®å®‰å…¨ãªå‡¦ç†**: ã™ã¹ã¦ã®æ•°å€¤è¨ˆç®—ã§äº‹å‰æ¤œè¨¼
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½**: ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã§ã‚‚é©åˆ‡ãªè¡¨ç¤º
- **å‹å®‰å…¨æ€§**: undefined/nullå€¤ã®é©åˆ‡ãªå‡¦ç†

### 2. ã‚³ãƒ¼ãƒ‰ä¿å®ˆæ€§ã®å‘ä¸Š
- **å˜ä¸€è²¬ä»»åŸå‰‡**: å„é–¢æ•°ãŒæ˜ç¢ºãªå½¹å‰²ã‚’æŒã¤
- **ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡å‰Šé™¤**: å…±é€šã®PDFæ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯
- **å¯èª­æ€§**: è¤‡é›‘ãªä¸‰é …æ¼”ç®—å­ã®ç°¡ç•¥åŒ–

### 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®æ”¹å–„
- **ä¸€è²«ã—ãŸè¡¨ç¤º**: ã™ã¹ã¦ã®ã‚±ãƒ¼ã‚¹ã§é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **ç›´æ„Ÿçš„ãªæƒ…å ±**: ã€ŒPDF Parserã€ã€ŒPDFè§£æ: ç„¡æ–™ã€ç­‰
- **ä¿¡é ¼æ€§**: äºˆæœŸã—ãªã„NaNè¡¨ç¤ºã®å®Œå…¨æ’é™¤

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### 1. å³åº§ã®å•é¡Œè§£æ±º
- âœ… ã€ŒNaNåˆ†NaNç§’ã€â†’ã€Œ16ç§’ã€ã€Œ2åˆ†30ç§’ã€ç­‰ã®é©åˆ‡ãªè¡¨ç¤º
- âœ… PDFå‡¦ç†æ–¹æ³•ãŒæ­£ã—ãã€ŒPDF Parserã€ã¨è¡¨ç¤º
- âœ… å‡¦ç†æ™‚é–“ãŒã€Œè¨ˆæ¸¬ä¸­...ã€ã‹ã‚‰å®Ÿéš›ã®ç§’æ•°ã«å¤‰æ›´
- âœ… ã‚³ã‚¹ãƒˆãŒã€ŒPDFè§£æ: ç„¡æ–™ã€ã¨ã—ã¦æ˜ç¢ºã«è¡¨ç¤º

### 2. å …ç‰¢æ€§ã®å‘ä¸Š
- ğŸ”„ analysisTypeãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒãªãã¦ã‚‚PDFæ¤œå‡ºå¯èƒ½
- ğŸ”„ ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã§ã‚‚ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãªã„
- ğŸ”„ å°†æ¥ã®PDFã‚¨ãƒ³ãƒˆãƒªãƒ¼ã«ã‚‚è‡ªå‹•å¯¾å¿œ

### 3. é–‹ç™ºåŠ¹ç‡ã®å‘ä¸Š
- ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„ã‚³ãƒ¼ãƒ‰æ§‹é€ 
- ğŸ› ï¸ æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ã®è¿½åŠ ãŒå®¹æ˜“
- ğŸ› ï¸ æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

## å½±éŸ¿ç¯„å›²

### å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«
- **src/components/pages/AnalyzePage.tsx**: PDFæ™‚é–“è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯å…¨èˆ¬ã®æ”¹å–„

### å¾Œæ–¹äº’æ›æ€§
- âœ… æ—¢å­˜ã®analysisType='pdf'ãƒ‡ãƒ¼ã‚¿ã¯å¼•ãç¶šãå‹•ä½œ
- âœ… YouTube/éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®è¡¨ç¤ºã«å½±éŸ¿ãªã—
- âœ… æ—¢å­˜ã®ã‚³ã‚¹ãƒˆè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ç¶­æŒ

### å‰¯ä½œç”¨
- ãªã—ï¼ˆæ”¹å–„ã®ã¿ã§æ—¢å­˜æ©Ÿèƒ½ã«æ‚ªå½±éŸ¿ãªã—ï¼‰

## ãƒ†ã‚¹ãƒˆæ¨å¥¨é …ç›®

1. **PDFè¡¨ç¤ºã®ç¢ºèª**
   - å‡¦ç†æ™‚é–“ãŒé©åˆ‡ãªç§’æ•°ã§è¡¨ç¤ºã•ã‚Œã‚‹
   - NaNè¡¨ç¤ºãŒå®Œå…¨ã«è§£æ¶ˆã•ã‚Œã‚‹
   - é–‹å§‹ãƒ»çµ‚äº†æ™‚é–“ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹

2. **ä»–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ã¸ã®å½±éŸ¿ç¢ºèª**
   - YouTubeå‹•ç”»ã®è¡¨ç¤ºãŒå¤‰ã‚ã‚‰ãªã„
   - éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®è¡¨ç¤ºãŒå¤‰ã‚ã‚‰ãªã„
   - ã‚³ã‚¹ãƒˆè¨ˆç®—ã«å½±éŸ¿ãŒãªã„

3. **ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ç¢ºèª**
   - ä¸å®Œå…¨ãªanalysisTimeã§ã‚‚ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãªã„
   - ç„¡åŠ¹ãªdurationå€¤ã§ã‚‚é©åˆ‡ã«è¡¨ç¤ºã•ã‚Œã‚‹

## ã‚³ãƒŸãƒƒãƒˆæƒ…å ±

- **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥**: 62bf498
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: "fix: Comprehensive PDF time display fixes"
- **å¤‰æ›´è¡Œæ•°**: 45è¡Œè¿½åŠ ã€27è¡Œå‰Šé™¤
- **å®Ÿè£…æ—¥æ™‚**: 2025-07-22 00:48:40 UTC

ã“ã®åŒ…æ‹¬çš„ãªä¿®æ­£ã«ã‚ˆã‚Šã€PDFåˆ†æç”»é¢ã§ã®æ™‚é–“è¡¨ç¤ºå•é¡ŒãŒæ ¹æœ¬çš„ã«è§£æ±ºã•ã‚Œã€ã‚ˆã‚Šä¿¡é ¼æ€§ã®é«˜ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ãŒå®Ÿç¾ã•ã‚Œã¾ã—ãŸã€‚