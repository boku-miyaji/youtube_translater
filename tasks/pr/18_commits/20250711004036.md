# Issue #18 å®Ÿè£…å·®åˆ†ã¾ã¨ã‚ - 20250711004036

## ã‚³ãƒŸãƒƒãƒˆæƒ…å ±
- **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥**: 07b6def
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: feat: Add GPT model display and auto-recalculation for cost estimation

## å®Ÿè£…å†…å®¹

### GPTãƒ¢ãƒ‡ãƒ«è¡¨ç¤ºã¨ã‚³ã‚¹ãƒˆè‡ªå‹•å†è¨ˆç®—æ©Ÿèƒ½
ã‚³ã‚¹ãƒˆäºˆæ¸¬ã«ãŠã„ã¦ã€ä½¿ç”¨GPTãƒ¢ãƒ‡ãƒ«ã®è¡¨ç¤ºã¨ã€ãƒ¢ãƒ‡ãƒ«å¤‰æ›´æ™‚ã®è‡ªå‹•ã‚³ã‚¹ãƒˆå†è¨ˆç®—æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

### ä¸»ãªå¤‰æ›´å†…å®¹

#### 1. å‹å®šç¾©æ‹¡å¼µ (types/index.ts)

**CostEstimationResponseå‹ã®æ‹¡å¼µ**
```typescript
export interface CostEstimationResponse {
  success: boolean;
  title?: string;
  duration?: number;  // seconds
  durationFormatted?: string;
  gptModel?: string;  // GPT model used for cost calculation  â† NEW
  estimatedCosts?: {
    transcription: number;
    summary: number;
    article: number;
    total: number;
  };
  error?: string;
  message?: string;
}
```

**FileCostEstimationResponseå‹ã®æ‹¡å¼µ**
```typescript
export interface FileCostEstimationResponse {
  // ... åŒæ§˜ã«gptModelãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
  gptModel?: string;  // GPT model used for cost calculation  â† NEW
}
```

#### 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ”¹å–„ (server.ts)

**URLã‚³ã‚¹ãƒˆäºˆæ¸¬APIãƒ¬ã‚¹ãƒãƒ³ã‚¹æ‹¡å¼µ**
```typescript
const response: CostEstimationResponse = {
  success: true,
  title: videoDetails.title,
  duration,
  durationFormatted: formatDuration(duration),
  gptModel,  // â† ä½¿ç”¨ã—ãŸGPTãƒ¢ãƒ‡ãƒ«åã‚’å«ã‚ã‚‹
  estimatedCosts: {
    transcription: transcriptionCost,
    summary: gptCosts.summary,
    article: gptCosts.article,
    total: totalCost
  },
  message: 'Cost estimation completed'
};
```

**ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ã‚¹ãƒˆäºˆæ¸¬APIãƒ¬ã‚¹ãƒãƒ³ã‚¹æ‹¡å¼µ**
```typescript
const response: FileCostEstimationResponse = {
  success: true,
  filename: originalName,
  duration,
  durationFormatted: formatDuration(duration),
  gptModel,  // â† ä½¿ç”¨ã—ãŸGPTãƒ¢ãƒ‡ãƒ«åã‚’å«ã‚ã‚‹
  estimatedCosts: { ... },
  message: 'Cost estimation completed'
};
```

#### 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ”¹å–„ (AnalyzePage.tsx)

**ã‚³ã‚¹ãƒˆè¡¨ç¤ºUIã®æ‹¡å¼µ**
```typescript
// ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«è¡¨ç¤ºã®è¿½åŠ 
<div className="flex justify-between">
  <span>ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«:</span>
  <span className="font-mono">{costEstimation.gptModel || 'N/A'}</span>
</div>
```

**ãƒ¢ãƒ‡ãƒ«å¤‰æ›´æ™‚ã®è‡ªå‹•å†è¨ˆç®—æ©Ÿèƒ½**
```typescript
const isFirstModelChange = useRef(true)

// ãƒ¢ãƒ‡ãƒ«å¤‰æ›´ç›£è¦–ç”¨useEffect
useEffect(() => {
  console.log('ğŸ”„ Model changed to:', model)
  
  // åˆå›å®Ÿè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
  if (isFirstModelChange.current) {
    isFirstModelChange.current = false
    return
  }
  
  // æ—¢å­˜ã®ã‚³ã‚¹ãƒˆäºˆæ¸¬ãŒã‚ã‚‹å ´åˆã®ã¿å†è¨ˆç®—
  if (costEstimation && costEstimation.success && !loadingCostEstimation) {
    console.log('ğŸ”„ Re-calculating cost estimation due to model change')
    
    if (inputType === 'url' && url.trim() && validateYouTubeUrl(url.trim())) {
      estimateCostForUrl(url.trim())
    } else if (inputType === 'file' && videoFile) {
      estimateCostForFile(videoFile)
    }
  }
}, [model])
```

### æŠ€è¡“çš„ãªæ”¹å–„ç‚¹

1. **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š**
   - ã©ã®GPTãƒ¢ãƒ‡ãƒ«ã§ã‚³ã‚¹ãƒˆè¨ˆç®—ã•ã‚ŒãŸã‹ãŒæ˜ç¢º
   - ãƒ¢ãƒ‡ãƒ«å¤‰æ›´æ™‚ã®å³åº§ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
   - ä¸è¦ãªåˆå›è¨ˆç®—ã®å›é¿

2. **é€æ˜æ€§ã®å‘ä¸Š**
   - ã‚³ã‚¹ãƒˆç®—å‡ºæ ¹æ‹ ã®æ˜ç¤º
   - ãƒ¢ãƒ‡ãƒ«é–“ã®ã‚³ã‚¹ãƒˆå·®ç•°ãŒç¬æ™‚ã«åˆ†ã‹ã‚‹
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ„å›³çš„ã«ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠå¯èƒ½

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é…æ…®**
   - åˆå›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã®ä¸è¦ãªè¨ˆç®—ã‚’å›é¿
   - ãƒ‡ãƒã‚¦ãƒ³ã‚¹ã•ã‚ŒãŸã‚¿ã‚¤ãƒãƒ¼ç®¡ç†ã®ç¶™ç¶š
   - ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ã®é©åˆ‡ãªä¾å­˜é…åˆ—ç®¡ç†

### ãƒ†ã‚¹ãƒˆçµæœ

**APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ç¢ºèª**
```bash
# gpt-4o ã§ã®è¨ˆç®—
curl /api/estimate-cost-url -d '{"gptModel":"gpt-4o"}'
â†’ summary: $0.0007800 (é«˜ã‚³ã‚¹ãƒˆ)

# gpt-4o-mini ã§ã®è¨ˆç®—  
curl /api/estimate-cost-url -d '{"gptModel":"gpt-4o-mini"}'
â†’ summary: $0.0001128 (ä½ã‚³ã‚¹ãƒˆ)
```

**ãƒ“ãƒ«ãƒ‰ãƒ»å“è³ªãƒã‚§ãƒƒã‚¯**
- TypeScript ãƒ“ãƒ«ãƒ‰: âœ… æˆåŠŸ
- ESLint ãƒã‚§ãƒƒã‚¯: âœ… ã‚¨ãƒ©ãƒ¼ãªã—ï¼ˆè­¦å‘Šã®ã¿ï¼‰

### æ©Ÿèƒ½ãƒ‡ãƒ¢

**è¡¨ç¤ºä¾‹:**
```
ğŸ’° æƒ³å®šã‚³ã‚¹ãƒˆï¼ˆæ¦‚ç®—ï¼‰
å‹•ç”»æ™‚é–“: 3åˆ†34ç§’
ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«: gpt-4o-mini     â† NEW!
æ–‡å­—èµ·ã“ã—: $0.0240
è¦ç´„ç”Ÿæˆ: $0.0001
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
åˆè¨ˆ: $0.0241

â€»å®Ÿéš›ã®ã‚³ã‚¹ãƒˆã¯ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚„ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã«ã‚ˆã‚Šå¤‰å‹•ã—ã¾ã™
```

**å‹•ä½œä¾‹:**
1. YouTube URLå…¥åŠ› â†’ ã‚³ã‚¹ãƒˆè¡¨ç¤ºï¼ˆgpt-4o-mini: $0.0241ï¼‰
2. ãƒ¢ãƒ‡ãƒ«ã‚’gpt-4oã«å¤‰æ›´ â†’ è‡ªå‹•å†è¨ˆç®—ï¼ˆgpt-4o: $0.0248ï¼‰
3. ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«æ¬„ã‚‚å³åº§ã«æ›´æ–°

### å½±éŸ¿ç¯„å›²
- AnalyzePageã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ã‚¹ãƒˆè¡¨ç¤ºã¨ãƒ­ã‚¸ãƒƒã‚¯æ‹¡å¼µ
- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã®æ‹¡å¼µ
- å‹å®šç¾©ã®æ‹¡å¼µï¼ˆä¸‹ä½äº’æ›æ€§ç¶­æŒï¼‰

ã“ã®æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚³ã‚¹ãƒˆç®—å‡ºã®é€æ˜æ€§ã‚’å¾—ã‚‹ã¨åŒæ™‚ã«ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ¢ãƒ‡ãƒ«é¸æŠã®å½±éŸ¿ã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚