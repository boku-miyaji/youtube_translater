# Issue #18 å®Ÿè£…å·®åˆ†ã¾ã¨ã‚ - 20250711002503

## ã‚³ãƒŸãƒƒãƒˆæƒ…å ±
- **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥**: 7187266
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: fix: Enhance error handling and debugging for cost estimation API

## å®Ÿè£…å†…å®¹

### 500ã‚¨ãƒ©ãƒ¼å¯¾å¿œã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
ã‚³ã‚¹ãƒˆäºˆæ¸¬API ã§ç™ºç”Ÿã—ã¦ã„ãŸ 500 Internal Server Error ã®åŸå› ç‰¹å®šã¨è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±æä¾›æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

### ä¸»ãªå¤‰æ›´å†…å®¹

#### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ”¹å–„ (AnalyzePage.tsx)

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹è©³ç´°å–å¾—**
```typescript
// å¾“æ¥ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
} else {
  const errorText = await response.text()
  console.error('âŒ Failed to estimate cost:', response.status, errorText)
}

// æ”¹å–„å¾Œã®è©³ç´°ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
} else {
  let errorDetails = ''
  try {
    const errorData = await response.json()
    errorDetails = JSON.stringify(errorData, null, 2)
    console.error('âŒ Failed to estimate cost (JSON):', response.status, errorData)
  } catch {
    const errorText = await response.text()
    errorDetails = errorText
    console.error('âŒ Failed to estimate cost (Text):', response.status, errorText)
  }
  // ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã‚’è¨­å®šï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
  setCostEstimation({
    success: false,
    error: `API Error ${response.status}: ${errorDetails}`,
    debug: true
  })
}
```

**UIã‚¨ãƒ©ãƒ¼è¡¨ç¤ºè¿½åŠ **
```typescript
// ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®è¦–è¦šçš„è¡¨ç¤º
if (costEstimation && costEstimation.debug) {
  return (
    <div className="p-3 rounded-lg bg-red-50 border border-red-200">
      <div className="flex items-start gap-2">
        <span className="text-red-600 text-lg">âš ï¸</span>
        <div className="flex-1">
          <div className="text-sm font-medium text-red-800 mb-1">
            ã‚³ã‚¹ãƒˆäºˆæ¸¬ã‚¨ãƒ©ãƒ¼
          </div>
          <div className="text-xs text-red-700">
            {costEstimation.error}
          </div>
          <div className="text-xs text-red-600 mt-1">
            è©³ç´°ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„
          </div>
        </div>
      </div>
    </div>
  )
}
```

#### 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ”¹å–„ (server.ts)

**è©³ç´°ãƒ­ã‚°å‡ºåŠ›**
```typescript
app.post('/api/estimate-cost-url', async (req: Request, res: Response) => {
  console.log('ğŸ“Š Cost estimation request for URL', req.body);
  
  try {
    const { url, gptModel = 'gpt-4o-mini', generateSummary = true, generateArticle = false } = req.body;
    
    console.log('ğŸ“Š Request params:', { url, gptModel, generateSummary, generateArticle });
    console.log('ğŸ“Š Validating YouTube URL:', url);
    console.log('ğŸ“Š Getting video info from YouTube for:', url);
    console.log('ğŸ“Š Got video info successfully');
    console.log('ğŸ“Š Video details:', { title, duration, durationMinutes });
    console.log('ğŸ“Š Calculating costs...');
    
    // ... å‡¦ç†ç¶šè¡Œ
  } catch (error) {
    // è©³ç´°ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°å‡ºåŠ›
  }
});
```

**å¼·åŒ–ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
```typescript
} catch (error) {
  console.error('âŒ Error estimating cost for URL:');
  console.error('âŒ Error details:', error);
  console.error('âŒ Stack trace:', error instanceof Error ? error.stack : 'No stack trace');
  
  const errorMessage = error instanceof Error ? error.message : 'Unknown error during cost estimation';
  console.error('âŒ Error message to client:', errorMessage);
  
  res.status(500).json({
    success: false,
    error: errorMessage,
    details: process.env.NODE_ENV === 'development' ? 
      (error instanceof Error ? error.stack : String(error)) : undefined
  } as CostEstimationResponse);
}
```

### æŠ€è¡“çš„ãªæ”¹å–„ç‚¹

1. **ã‚¨ãƒ©ãƒ¼åŸå› ã®ç‰¹å®šå®¹æ˜“åŒ–**
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã®å®Œå…¨ãƒ­ã‚°å‡ºåŠ›
   - å‡¦ç†æ®µéšã”ã¨ã®è©³ç´°ãƒ­ã‚°
   - ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®ä¿å­˜

2. **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š**
   - ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
   - è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã®è¡¨ç¤º
   - é–‹ç™ºè€…å‘ã‘ãƒ‡ãƒãƒƒã‚°æƒ…å ±

3. **ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã®çµ±ä¸€**
   - JSON/ãƒ†ã‚­ã‚¹ãƒˆä¸¡å½¢å¼ã®å¯¾å¿œ
   - é–‹ç™ºç’°å¢ƒã§ã®è©³ç´°æƒ…å ±æä¾›
   - æœ¬ç•ªç’°å¢ƒã§ã®é©åˆ‡ãªæƒ…å ±åˆ¶é™

### ãƒ†ã‚¹ãƒˆçµæœ

**APIæ­£å¸¸å‹•ä½œç¢ºèª**
```bash
# æœ‰åŠ¹ãªURL
curl -X POST /api/estimate-cost-url -d '{"url":"https://www.youtube.com/watch?v=dQw4w9WgXcQ"}'
â†’ 200 OK: æ­£å¸¸ã«ã‚³ã‚¹ãƒˆæƒ…å ±ã‚’è¿”å´

# ç„¡åŠ¹ãªURL
curl -X POST /api/estimate-cost-url -d '{"url":"https://www.youtube.com/watch?v=invalid"}'  
â†’ 500 Error: "Video unavailable" ã®è©³ç´°ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’è¿”å´
```

**ãƒ“ãƒ«ãƒ‰ãƒ»å“è³ªãƒã‚§ãƒƒã‚¯**
- TypeScript ãƒ“ãƒ«ãƒ‰: âœ… æˆåŠŸ
- ESLint ãƒã‚§ãƒƒã‚¯: âœ… ã‚¨ãƒ©ãƒ¼ãªã—ï¼ˆè­¦å‘Šã®ã¿ï¼‰

### å½±éŸ¿ç¯„å›²
- AnalyzePageã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰APIã®è©³ç´°ãƒ­ã‚°æ©Ÿèƒ½è¿½åŠ 
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Šï¼ˆã‚¨ãƒ©ãƒ¼çŠ¶æ³ã®å¯è¦–åŒ–ï¼‰

ã“ã®æ”¹å–„ã«ã‚ˆã‚Šã€500ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸéš›ã®åŸå› ç‰¹å®šãŒå®¹æ˜“ã«ãªã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚‚é©åˆ‡ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒæä¾›ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚