# YouTube動画文字起こし・AI質問応答システム 要件定義書

## 1. システム概要

### 1.1 システム名
YouTube動画文字起こし・AI質問応答システム

### 1.2 システムの目的
YouTubeの動画URLを入力することで、動画の音声を自動的に文字起こしし、その内容に対してAIを活用した質問応答を可能にするWebアプリケーションシステム。

### 1.3 対象ユーザー
- YouTube動画の内容を効率的に把握したい個人・企業ユーザー
- 動画コンテンツの分析・要約を必要とする研究者・学習者
- アクセシビリティ向上を目的とする教育機関・団体

## 2. 機能要件

### 2.1 文字起こし機能

#### 2.1.1 YouTube動画処理
- **機能概要**: YouTubeのURLから動画の音声を抽出し、文字起こしを実行
- **入力**: YouTube動画のURL
- **処理**: 
  1. URL検証（有効なYouTube URLか確認）
  2. YouTube字幕の自動取得（日本語優先、英語も対応）
  3. 字幕がない場合はWhisper APIによる音声文字起こし
- **出力**: 文字起こしテキスト、処理方法（字幕/Whisper）、料金情報

#### 2.1.2 音声抽出・圧縮
- **音声品質**: ビットレート64kbps、モノラル、16kHzサンプリングレート
- **ファイルサイズ制限**: 25MB（Whisper API制限）
- **大容量対応**: 25MB超過時は10分セグメントに自動分割して処理

#### 2.1.3 文字起こし精度向上
- **言語設定**: 日本語優先（'ja'）
- **モデル**: OpenAI Whisper-1

### 2.2 AI質問応答機能

#### 2.2.1 チャット機能
- **機能概要**: 文字起こし結果を基にしたAIとの対話
- **AIモデル**: GPT-4o-mini
- **入力**: ユーザーの質問テキスト
- **処理**: 文字起こし内容をコンテキストとしてAIが回答生成
- **出力**: AI回答、トークン使用量、料金情報

### 2.3 履歴管理機能

#### 2.3.1 履歴保存
- **保存項目**: 
  - 動画ID、タイトル、URL
  - 文字起こしテキスト
  - 処理方法（字幕/Whisper）
  - 処理日時、料金
- **保存形式**: JSON形式
- **保存場所**: サーバーローカル（history/transcripts.json）
- **保存件数**: 最大100件（古いものから自動削除）

#### 2.3.2 履歴参照
- **機能**: 過去の文字起こし結果をワンクリックで再読み込み
- **重複処理回避**: 同一動画IDの場合は履歴から瞬時に取得
- **UI表示**: 日時、動画タイトル、処理方法、料金を一覧表示

### 2.4 料金計算・表示機能

#### 2.4.1 料金体系（2024年6月時点）
- **Whisper API**: $0.006/分
- **GPT-4o-mini**: 
  - 入力トークン: $0.15/100万トークン
  - 出力トークン: $0.60/100万トークン

#### 2.4.2 料金表示
- **セッション単位**: Whisper使用料、GPT使用料、合計料金
- **リアルタイム更新**: 各API使用時に即座に料金更新
- **詳細表示**: トークン使用量も併せて表示

## 3. 非機能要件

### 3.1 性能要件
- **応答時間**: 
  - 字幕取得: 5秒以内
  - Whisper処理: 動画1分あたり30秒以内
  - AI回答生成: 10秒以内
- **同時接続数**: 10ユーザーまで
- **処理可能動画長**: 最大120分

### 3.2 可用性要件
- **稼働時間**: 開発・テスト用途（24時間稼働不要）
- **データバックアップ**: 履歴データの手動バックアップ対応

### 3.3 セキュリティ要件
- **API キー管理**: 環境変数による秘匿情報管理
- **入力検証**: URL形式検証、不正リクエスト防御
- **一時ファイル**: 音声ファイルの処理後自動削除

### 3.4 拡張性要件
- **TypeScript対応**: 型安全性確保のためのTS実装準備完了
- **API拡張**: RESTful API設計による機能追加容易性

## 4. システム構成

### 4.1 技術スタック
- **バックエンド**: Node.js, Express.js
- **フロントエンド**: HTML5, CSS3, Vanilla JavaScript
- **AI API**: OpenAI API (Whisper, GPT-4o-mini)
- **YouTube処理**: @distube/ytdl-core, youtube-transcript-api
- **音声処理**: fluent-ffmpeg

### 4.2 ディレクトリ構成
```
youtube_translater/
├── server.js              # メインサーバーファイル
├── src/server.ts          # TypeScript版サーバー
├── package.json           # 依存関係定義
├── tsconfig.json          # TypeScript設定
├── public/
│   └── index.html         # フロントエンドUI
├── uploads/               # 一時音声ファイル
├── transcripts/           # 文字起こしファイル
└── history/               # 履歴データ
    └── transcripts.json   # 履歴JSON
```

### 4.3 API エンドポイント
- `POST /upload-youtube`: YouTube動画処理
- `POST /chat`: AI質問応答
- `GET /history`: 履歴取得
- `POST /load-from-history`: 履歴から読み込み
- `GET /costs`: 料金情報取得
- `GET /transcript`: 現在の文字起こし取得

## 5. データ設計

### 5.1 履歴データ構造
```json
{
  "id": "YouTube動画ID",
  "title": "動画タイトル",
  "url": "YouTube URL",
  "transcript": "文字起こしテキスト",
  "method": "subtitle|whisper",
  "cost": 0.0000,
  "timestamp": "ISO日時文字列"
}
```

### 5.2 セッション料金データ
```json
{
  "whisper": 0.0000,
  "gpt": 0.0000,
  "total": 0.0000
}
```

## 6. ユーザーインターフェース要件

### 6.1 画面構成
1. **YouTube動画アップロード部**: URL入力、処理開始ボタン
2. **文字起こし結果表示部**: スクロール可能なテキストエリア
3. **AI質問応答部**: チャット形式のメッセージ表示
4. **料金表示部**: Whisper、GPT、合計料金の詳細表示
5. **履歴表示部**: 過去の処理履歴一覧、クリック読み込み

### 6.2 操作性要件
- **レスポンシブデザイン**: モバイル・タブレット対応
- **直感的操作**: ワンクリックでの履歴読み込み
- **リアルタイム更新**: 処理状況・料金の即座反映

## 7. 制約事項

### 7.1 技術的制約
- **Whisper API制限**: 25MBファイルサイズ上限
- **YouTube API制限**: 公式APIは使用せず、サードパーティライブラリに依存
- **料金制約**: OpenAI API使用量に応じた従量課金

### 7.2 運用制約
- **環境変数必須**: OPENAI_API_KEYの事前設定必要
- **依存ライブラリ**: FFmpegの事前インストール必要
- **ストレージ**: ローカルファイルシステムでの履歴管理

## 8. 今後の拡張予定

### 8.1 機能拡張
- **多言語対応**: 英語・中国語等の文字起こし対応
- **要約機能**: 長時間動画の自動要約生成
- **検索機能**: 履歴内容の全文検索
- **エクスポート機能**: 文字起こし結果のファイル出力

### 8.2 技術的改善
- **データベース導入**: SQLite/PostgreSQLによる履歴管理
- **認証機能**: ユーザー管理・セッション管理
- **キャッシュ機能**: Redis等による処理結果キャッシュ
- **クラウド対応**: AWS/GCP等のクラウドデプロイ

---

**作成日**: 2025年6月17日  
**バージョン**: 1.0  
**作成者**: Claude Code System